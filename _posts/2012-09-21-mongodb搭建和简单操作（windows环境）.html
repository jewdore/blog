---
layout: post
title: MongoDB搭建和简单操作（windows环境）
---

<p>昨天看到fish的MongoDB，但遇到不少问题，于是自己一步一步尝试，将遇到之问题和解决方法记录总结</p><p>首先感谢fish！昨天忘了放链接：http://www.cnblogs.com/fish-li/archive/2011/06/26/2090800.html</p><p>再有就是快一年没更新博客了，不过本人天天打开博客园看各位的博文，就像公务员每天上班喝茶看报纸一样，习惯了。。。</p><p>尽量以后每月出个两篇文章吧，本人这一年没写博客就干了一个活，www.520.cn，请大家赏析，前台使用mvc2.0，spark引擎，Entity Framework，当然还有jQuery</p><p>这篇写完，这周再出个简单用C#操作MongoDB的增删改查，Demo将会以MVC+SPARK的方式出现，哎，为什么没几个人用spark，这么好的东西，比什么razor好多了，只是没有智能提示而已~</p><p>您可以在这个地址下载到MongoDB: http://www.mongodb.org/downloads本人环境32位win7旗舰片，因此下载到mongodb-win32-i386-1.8.2在下载页的下方官方有提供各种开发语言的驱动，本人C#，直接移位https://github.com/samus/mongodb-csharp下载即可一，安装mongoDB1，解压mongodb-win32-i386-1.8.2至E:\MyProgram\mongodb-win32-i386-1.8.2（你可以按照自己的路径来，路径中最好不要有空格，要不然麻烦）2，新建文件夹C:\DATA\DB，这是mongoDB的默认数据文件夹，你也可以在文件夹E:\MyProgram\mongodb-win32-i386-1.8.2新建一个文件夹data作为mongoDB的数据库文件存储目录3，进入CMD，运行命令E:\MyProgram\mongodb-win32-i386-1.8.2\bin\mongod.exe -dbpath E:\MyProgram\mongodb-win32-i386-1.8.2\data，OK，mongoDB已经安装成功并已经在运行中了，你将会看到如下：</p><p>此时是mongoDB的运行状态，你可以按Ctrl+C结束运行状态或者直接关掉CMD结束运行。二，运行mongoDB时的错误与处理完成安装后，结束掉所有CMD窗口，然后进行如下操作：1，运行E:\MyProgram\mongodb-win32-i386-1.8.2\bin\mongo，可能会报错误：couldn't connect to server 127.0.0.1 shell/mongo.js，原因是mongod.exe没有启动，2，既然没启动，那咱就启动呗，运行E:\MyProgram\mongodb-win32-i386-1.8.2\bin\mongod，可能会报错误：dbpath (/data/db/) does not exist, terminating，看这样子，本人觉得还得在data文件夹下再建一个db文件夹啊，如此即新建一db文件夹，再运行mongod命令，结果提示一样，不知道怎么搞啦，咱google吧找到文章http://www.mongodb.org/display/DOCS/Starting+and+Stopping+Mongo说&ldquo;To start Mongo in default mode, where data will be stored in the /data/db directory (or c:\data\db on Windows), and listening on port 27017&rdquo;，哦，原来默认的文档路径在c:\data\db，啥也不说，直接按这个建文件夹，再次运行命令mongod，OK了，启动成功，这个命令窗口不能关闭，否则mongoDB就退出了</p><p>三，使用mongo命令保持mongod命令窗口的运行状态，再新开一命令窗口输入E:\MyProgram\mongodb-win32-i386-1.8.2\bin\mongo，出现MongoDB shell version:1.8.2connecting to:test&gt;OK，连接成功。1，show dbs显示数据库列表2，use Northwind进入Northwind数据库,大小写敏感3，show collections显示数据库中的集合4，db用于查看当前所在的数据库5，db.Customer.count()查看集合Customer的记录总数6，db.Customer.findOne({"_id":"1"})查看CustomerId=1的记录</p><p>新增数据1，use MyTest，这个数据库不存在，无所谓，mongo会创建，MongoDB在使用前，并不要求您事先创建好相应的数据库，设计数据表结构！在MongoDB中，没有【表】的概念，取而代之的是【集合】，也没有【数据记录】的概念，取而代之的是【文档】，我们可以把【文档】理解成一个【对象】，任意的对象，甚至可以有复杂的嵌套层次。因此，我们不用再写代码从【数据表字段】到C#类的【属性，字段】的转换了，现在直接就可以读写整个对象了。而且MongoDB不支持Join操作，所以，如果有【关联】操作，就需要你自己来处理2，item={"Key":"1","text":"wokao","number":3}3，db.table1.insert(item)，mongo将建立集合table1，并将item插入，完成了新增加数据库的工作4，db.table1.find()显示table1中的数据，MongoDB的文档使用的是一种称为BSON格式的对象，与Javascript中的JSON类似5，额外的，输入item1={"Id":5,"str":"asdfasdf"}，再插入db.table1.insert(item1)，再用find()命令看，也插入成功了~，注意到结构和item不一样！但不建议这样做。注意到：【每个文档有一个名为 "_id" 的成员】，我可没有定义啊。其实，MongoDB会为每个文档都创建这样一个文档成员，我们指定的 "key", "id" 对于MongoDB来说：它们并不是【文档的主键】，MongoDB只认 "_id"，你可以指定，但如果不指定，MongoDB就自动添加。 </p><p>修改数据1，var t=db.table1.findOne({"Id":5})，获取一条记录2，t.str="wokao"3，db.table1.update({"Id":5},t)</p><p>删除数据db.table1.remove({"Id":5})</p><p>查找数据上面已经有find和findOne命令，即用于查询db.table1.find()MongoDB的查询条件中，并没有 &gt;, &lt;, &gt;= , &lt;= 这些运算符，而是使用 "$lt", "$lte", "$gt", "$gte" </p><p>新建表db.MyTest.table2.save({})</p><p>删除表db.table1.drop()或db.runCommand({"drop","table1"})</p><p>删除数据库db.runCommand({"dropDatabase": 1})，此命令只能删除当前数据库</p><p>获取服务端状态信息db.runCommand({"serverStatus" : 1})</p><p>更多介绍查看http://www.mongodb.org/display/DOCS/Home</p><p>在https://github.com/samus/mongodb-csharp可以下到C#的示例</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>