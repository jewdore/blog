---
layout: post
title: MongoDB学习资料七---MapReduce简单操作（转）
---

MongoDB也简单的实现了MapReduce的功能来提供分布式的数据查询服务,MapReduce的分布是功能主要用在Shard上<p style="margin-top: 1em; margin-right: 1em; margin-bottom: 0px; margin-left: 1em; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; list-style-type: none; list-style-position: initial; list-style-image: initial; word-wrap: normal; word-break: normal; line-height: 21px; font-weight: bold; ">CODE:</p><code style="border-bottom-color: #cccccc; border-bottom-width: 1px; border-bottom-style: solid; border-left-color: #cccccc; border-left-width: 1px; border-left-style: solid; padding-bottom: 0.5em; margin-top: 0px; margin-right: 1em; margin-bottom: 1em; margin-left: 1em; padding-left: 0.5em; padding-right: 0.5em; display: block; font: normal normal normal 12px/1.8em Courier, monospace; border-top-color: #cccccc; border-top-width: 1px; border-top-style: solid; border-right-color: #cccccc; border-right-width: 1px; border-right-style: solid; padding-top: 0.5em; ">db.runCommand({ mapreduce : &lt;collection&gt;,<wbr><wbr>map : &lt;mapfunction&gt;,<wbr><wbr>reduce : &lt;reducefunction&gt;<wbr><wbr>[, query : &lt;query filter object&gt;]<wbr><wbr>[, sort : &lt;sort the query.<wbr><wbr>useful for optimization&gt;]<wbr><wbr>[, limit : &lt;number of objects to return from collection&gt;]<wbr><wbr>[, out : &lt;output-collection name&gt;]<wbr><wbr>[, keeptemp: &lt;true|false&gt;]<wbr><wbr>[, finalize : &lt;finalizefunction&gt;]<wbr><wbr>[, scope : &lt;object where fields go into javascript global scope &gt;]<wbr><wbr>[, verbose : true]});</code>下面是对MapReduce的简单测试此例子来源于：http://www.mongodb.org/display/DOCS/MapReduce<p style="margin-top: 1em; margin-right: 1em; margin-bottom: 0px; margin-left: 1em; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; list-style-type: none; list-style-position: initial; list-style-image: initial; word-wrap: normal; word-break: normal; line-height: 21px; font-weight: bold; ">CODE:</p><code style="border-bottom-color: #cccccc; border-bottom-width: 1px; border-bottom-style: solid; border-left-color: #cccccc; border-left-width: 1px; border-left-style: solid; padding-bottom: 0.5em; margin-top: 0px; margin-right: 1em; margin-bottom: 1em; margin-left: 1em; padding-left: 0.5em; padding-right: 0.5em; display: block; font: normal normal normal 12px/1.8em Courier, monospace; border-top-color: #cccccc; border-top-width: 1px; border-top-style: solid; border-right-color: #cccccc; border-right-width: 1px; border-right-style: solid; padding-top: 0.5em; ">&gt; db.things.insert({_id:1,tags:['dog','cat']});<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>&gt; db.things.insert({_id:2,tags:['cat']});<wbr><wbr><wbr><wbr>&gt; db.things.insert({_id:3,tags:['mouse','cat','dog']});&gt; db.things.insert({_id:4,tags:[]});<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>&gt; m = function(){... this.tags.forEach(...<wbr><wbr>function(z){<wbr><wbr><wbr><wbr>...<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>emit(z,{count:1});...<wbr><wbr>}...<wbr><wbr>);};function () {<wbr><wbr>this.tags.forEach(function (z) {emit(z, {count:1});});}&gt; r=function(key,values){... var total = 0;... for(var i=0;i&lt;values.length;i++)... total += values[i].count;... return {count:total};... };function (key, values) {<wbr><wbr>var total = 0;<wbr><wbr>for (var i = 0; i &lt; values.length; i++) {<wbr><wbr><wbr><wbr><wbr><wbr>total += values[i].count;<wbr><wbr>}<wbr><wbr>return {count:total};}&gt; res=db.things.mapReduce(m,r);{<wbr><wbr><wbr><wbr><wbr><wbr>"result" : "tmp.mr.mapreduce_1268577545_1",<wbr><wbr><wbr><wbr><wbr><wbr>"timeMillis" : 25,<wbr><wbr><wbr><wbr><wbr><wbr>"counts" : {<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"input" : 4,<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"emit" : 6,<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"output" : 3<wbr><wbr><wbr><wbr><wbr><wbr>},<wbr><wbr><wbr><wbr><wbr><wbr>"ok" : 1,<wbr><wbr><wbr><wbr><wbr><wbr>"ok" : 1,}&gt; res{<wbr><wbr><wbr><wbr><wbr><wbr>"result" : "tmp.mr.mapreduce_1268577545_1",<wbr><wbr><wbr><wbr><wbr><wbr>"timeMillis" : 25,<wbr><wbr><wbr><wbr><wbr><wbr>"counts" : {<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"input" : 4,<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"emit" : 6,<wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr><wbr>"output" : 3<wbr><wbr><wbr><wbr><wbr><wbr>},<wbr><wbr><wbr><wbr><wbr><wbr>"ok" : 1,<wbr><wbr><wbr><wbr><wbr><wbr>"ok" : 1,}&gt; db[res.result].find(){ "_id" : "cat", "value" : { "count" : 3 } }{ "_id" : "dog", "value" : { "count" : 2 } }{ "_id" : "mouse", "value" : { "count" : 1 } }&gt; db[res.result].drop()true&gt; db[res.result].find()&gt;</code>以下有几个MapReduce的参考例子：http://www.mongodb.org/display/DOCS/MapReducehttp://github.com/mongodb/mongo/ ... sts/mr_bigobject.jshttp://github.com/mongodb/mongo/blob/master/jstests/mr5.jshttp://github.com/mongodb/mongo/blob/master/jstests/mr4.jshttp://github.com/mongodb/mongo/blob/master/jstests/mr3.jshttp://github.com/mongodb/mongo/blob/master/jstests/mr2.jshttp://github.com/mongodb/mongo/blob/master/jstests/mr1.js

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>