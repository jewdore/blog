---
layout: post
title: 如何在浏览器中获取当前执行的脚本文件名
---

背景<p>同事提了一个问题，如何在浏览器中动态插入的 JavaScript 文件中，获取当前文件名？</p><p>除了服务器输出一个文件名外，在脚本中获取应该只有下面三种做法。</p>解法A<p>普遍的解法，只能用于页面静态scripts标签引入或者单个动态加载。</p><pre><code class="chili-lang-javascript">var scripts = document.getElementsByTagName('script');var filename = scripts[scripts.length -1].src;</code></pre><p>动态插入多个脚本标签的情况：</p><pre><code class="chili-lang-javascript">loadScript('b.js?param=1')loadScript('a.js?param=2')loadScript('b.js?param=3')loadScript('a.js?param=4')/* 输出a.js >>> http://localhost:800/io/a.js?param=4a.js >>> http://localhost:800/io/a.js?param=4b.js >>> http://localhost:800/io/a.js?param=4b.js >>> http://localhost:800/io/a.js?param=4*/</code></pre>解法B<p>变态型，只能工作于FireFox：</p><pre><code class="chili-lang-javascript">try {     throw new Error();}catch(exception){    console.log( exception.fileName );}</code></pre>解法C<p>我的解法，操作源代码：</p><pre><code class="chili-lang-javascript">requireScript('a.js?'+Date.now(),function(text,src) {    console.log('text:',text);    globalEval('(function() { \nvar __filename = "'+ src +'";\n'+ text +'\n;})();');})</code></pre><p>浏览器输出：</p><pre><code class="chili-lang-html">&lt;script&gt;(function() { var __filename = "a.js?1310971812334";var scripts = document.getElementsByTagName('script');console.log('a.js',' &gt;&gt;&gt; ',scripts[scripts.length -1].src);console.log(__filename);;})();&lt;/script&gt;</code></pre><p>优点：可靠、可缓存、可推迟执行、可扩展。</p><p>限制：1）变量命名被约定为&ldquo;__filename&rdquo;；2）同源策略。</p><p>又想到这个加载策略用来加载流行的 CoffeeScript，比如：</p><pre><code class="chili-lang-javascript">requireScript('script.coffee',function(text,src) {    if( isCoffeeScript(src) )        globalEval( CoffeeScript.compile(text) );})</code></pre>链接<p>Cross-Origin Resource Sharing</p><p>Passing JavaScript arguments via the src attribute</p><p>CoffeeScript</p>查看或下载<p>https://gist.github.com/1088730</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>