---
layout: post
title: 构建Ubuntu Server试验环境
---

<p>目标：</p>  <p>现在在Linux下有很多非常强大的开源服务器组件，比如Redis, Memcached, RabbitMQ, MongoDB, Hadoop等，非常值得研究，因此准备着手做一个Ubuntu的虚拟机，在里面安装这些服务，供外部调用测试。</p>  <p>&#160;</p>  <p>第一步：使用Windows Server 2K8R2中的Hyper-V作为虚拟机宿主，因为我的电脑只有无线网卡，而Hyper-V默认不支持使用无线网卡作为虚拟机的网卡，因此需要做以下操作：</p>  <p>首先，在Virtual Network Manger里面天机一个Internal Only类型的虚拟网络：</p>          <p>然后，在Network Connections面板中，把无线网卡和新建的这个虚拟网络设备之间创建桥连接，创建好后如下图所示：</p>      <p>这样就算是设置好虚拟机的网络了，接下来开始Ubuntu Server的安装。</p>    <p>第二步，配置Ubuntu Server。</p>  <p>1. 设置虚拟机名和存放位置</p>    <p>2. 设置虚拟机的内存大小</p>    <p>3. 设置虚拟机使用的网卡，设置为刚刚添加的Virtual Internet连接</p>    <p>4. 为虚拟机系统设置硬盘，Hyper-V缺省创建的虚拟硬盘会根据实际使用增大，不会一开始就划定设定的大小</p>    <p>5. 为虚拟机安装系统，挂接Ubuntu Server的安装盘，这里我选择的是ubuntu-11.10-server-amd64.iso，然后这就完成了虚拟机的基本配置。</p>    <p>第三步，开始在虚拟机中安装Ubuntu Server了。</p>  <p>1. 启动虚拟机，进入安装界面，首先是选择安装提示语言类型，为了更好的兼容性，请选择English</p>  <p>2. 接下来，会出现具体的安装提示，直接按回车选择Install Ubuntu Server就行了</p>  <p>3. 选择系统的缺省语言，还是选择English, 国家选择United States</p>    <p>4. 在Configure the network时，会提示无法找到网卡，先点继续安装</p>    <p>5. 为虚拟机的Ubuntu Server设置一个机器名：</p>    <p>6. 设定时区，选择Asia里的Chongqing</p>    <p>7. 设定Ubuntu Server的磁盘分区，选择缺省的Guided – use entire disk and set up LVM即可，接下来几步都选Yes和缺省值即可</p>    <p>8. 完成基本的安装之后，安装向导会要求输入一个日常使用的帐号。（System Admin是用户名，sa是帐号ID，密码使用1234）</p>    <p>9. 接下来的Home目录是否加密选No, Http Proxy空着以及不自动更新升级</p>  <p>10. 最后是附加软件安装选择，请勾上Open SSH Server, LAMP Server， 然后继续，等待片刻之后，完成Ubuntu Server的初步安装。</p>    <p>第四步，配置Ubuntu Server环境。</p>  <p>1. 首先要做的肯定是配置Ubuntu Server的IP地址和DNS</p>  <p>Ubuntu的网络配置信息放在 /etc/network/interfaces 中，而DNS信息在/etc/resolv.conf中</p>  <p>首先使用sudo –s切换为root用户，再使用nano /etc/network/interfaces和nano /etc/resolv.conf命令分别设置IP和DNS，最后使用/etc/init.d/networking restart应用设置的IP地址和DNS。</p>  <p>可以使用ifconfig命令和ping命令来验证配置情况。</p>    <p>2. 因为此前在安装阶段已经选择了OpenSSH和LAMP，因此可以在宿主机器的浏览器中访问虚拟机里的Apache Server，验证是否工作正常；同时也可以使用pietty等SSH终端去连接虚拟机了</p>    <p>3. 执行sudo apt-get update，更新当前的Ubuntu Server，这可能会需要十几分钟</p>  <p>4. 再执行sudo apt-get install build-essential安装基本的编译环境。</p>  <p>5. 接下来我们就可以开始安装更多的Linux Service了。</p>  <p>第五步，安装Redis</p>  <p>1. 访问官方网站的下载页http://redis.io/download , 可以在下面的Installation节找到类似如下的安装命令示例，然后在Ubuntu Server环境中执行以下命令：</p>  <pre class="csharpcode">$ wget http://redis.googlecode.com/files/redis-2.4.4.tar.gz$ tar xzf redis-2.4.4.tar.gz$ cd redis-2.4.4$ make$ sudo make install</pre><style type="text/css">.csharpcode, .csharpcode pre{font-size: small;color: black;font-family: consolas, "Courier New", courier, monospace;background-color: #ffffff;/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {background-color: #f4f4f4;width: 100%;margin: 0em;}.csharpcode .lnum { color: #606060; }</style><style type="text/css">.csharpcode, .csharpcode pre{font-size: small;color: black;font-family: consolas, "Courier New", courier, monospace;background-color: #ffffff;/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {background-color: #f4f4f4;width: 100%;margin: 0em;}.csharpcode .lnum { color: #606060; }</style><p>2. 接下来是配置init启动脚本，命令行如下：</p><pre class="csharpcode">$ wget https://github.com/ijonas/dotfiles/raw/master/etc/init.d/redis-server$ sudo mv redis-server /etc/init.d/redis-server$ sudo mv redis.conf /etc/redis.conf</pre><pre class="csharpcode">$ sudo useradd redis</pre><pre class="csharpcode">$ sudo mkdir -p /var/lib/redis</pre><pre class="csharpcode">$ sudo mkdir -p /var/log/redis</pre><pre class="csharpcode">$ sudo chown redis.redis /var/lib/redis</pre><pre class="csharpcode">$ sudo chown redis.redis /var/log/redis</pre><style type="text/css">.csharpcode, .csharpcode pre{font-size: small;color: black;font-family: consolas, "Courier New", courier, monospace;background-color: #ffffff;/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {background-color: #f4f4f4;width: 100%;margin: 0em;}.csharpcode .lnum { color: #606060; }</style><p>3. 修改redis.conf文件，主要修改点节点是： </p><blockquote>  <pre>#是否作为后台服务运行，默认为no</pre>  <pre>daemonize yes</pre>  <pre>#客户端空闲多久会超时，默认为0（即永不过期）</pre>  <pre>timeout 300</pre>  <pre>#设置日志文件位置，默认为运行目录的stdout文件</pre>  <pre>logfile /var/log/redis/redis.log</pre>  <pre>#设置数据文件存放目录，默认为./</pre>  <pre>dir /var/lib/redis</pre></blockquote><blockquote>  <pre> </pre></blockquote><p>4. 把Redis设为开机启动，然后启动Redis，并进行验证 </p><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <code>sudo</code> <code>update-rc.d redis-server defaults</code></p><pre>sudo /etc/init.d/redis-server start</pre><pre>使用redis-cli连接服务器进行测试</pre><pre>之后如下图所示：</pre><p>（未完待续）</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>