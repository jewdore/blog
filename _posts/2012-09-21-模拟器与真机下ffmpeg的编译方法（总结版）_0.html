---
layout: post
title: 模拟器与真机下ffmpeg的编译方法（总结版）
---

<p>编译ffmepg模拟器版本：1. 到https://github.com/gabriel/ffmpeg-iphone-build下载ffmpeg-iphone-build2.先将gas-preprocessor.pl拷贝到/usr/sbin/目录中。3.到ffmpeg官网上下载ffmpeg源码4.在终端下定位到ffmpeg的目录运行./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --disable-avfilter --disable-debug --disable-encoders --enable-cross-compile --disable-decoders --disable-armv5te --enable-decoder=h264 --enable-pic --cc=/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc' --extra-ldflags=-L/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk/usr/lib/system --sysroot=/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator4.3.sdk --target-os=darwin --arch=i386 --cpu=i386 --extra-cflags='-arch i386' --extra-ldflags='-arch i386'5.输入make命令6.将libavcodec.a，libavdevice.a，libavformat.a，libavutil.a，libswscale.a到对应的目录下拷贝出来。7.在项目中就可以使用了。可以参考开源示例iFrameExtractor （git clone git://github.com/lajos/iFrameExtractor.git）需要将该项目的ffmpeg文件夹库替换为你编译的ffmpeg源码文件夹，在ffmpeg目录下新建lib目录，将刚刚拷贝出来的静态库拷贝进去。打开项目，添加libbz2.1.0.dylib系统库文件。点击编译运行就可以使用了。8.注意如果使用的是ffmpeg0.8.5的库的话iFrameExtractor中的codec_type需要修改为AVMEDIA_TYPE_VIDEO。（下同）编译arm7版本，网上搜到的版本，完全按照以下步骤做就行了。可以编译出arm7的库。1.下载:git clone git://github.com/lajos/iFrameExtractor.git2. 编辑:build_armv6和build_armv7,修改./configure后面的参数,主要是SDK版本.我的是4.3,修改为:./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --enable-cross-compile --arch=arm --target-os=darwin --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --cpu=arm1176jzf-s --extra-cflags='-arch armv6' --extra-ldflags='-arch armv6'3. 编译:出错,提示:/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc is unable to create an executable file.C compiler test failed.查看config.err文件,最后提示:ld: file not found: /usr/lib/system/libcache.dylib for architecture armv7collect2: ld returned 1 exit status4. 重新修改configure参数为:./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --enable-cross-compile --arch=arm --target-os=darwin --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --cpu=cortex-a8 --extra-cflags='-arch armv7' --extra-ldflags='-arch armv7 -isysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk' --enable-pic5. 编译:build_armv7最后生成静态库,在lib目录和armv7目录.6.用xcode打开iFrameExtractor.xcodeproj,现在编译会出错,需要修改几个地方:左边选中工程,中间选中target,右面选中Build settings,在Architectures选项卡里面选择Architetures为Optimized(armv7),Base SDK为LatestiOS(iOS 4.3) Valid Architectures填写armv7.编译目标选择iOS Device,当然,如果有连接电脑的设备,可以选择设备.编译,提示:Undefined symbols for architecture armv7: "_BZ2_bzDecompressInit", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o) "_BZ2_bzDecompressEnd", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o) "_BZ2_bzDecompress", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o)添加库libbz2.1.0.dylib,再次编译,OK通过在ios5.0中编译ffmpeg。 到官网下载ffmpeg，然后在终端进入ffmpeg./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --enable-cross-compile --arch=arm --target-os=darwin --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS5.0.sdk --cpu=cortex-a8 --extra-cflags='-arch armv7' --extra-ldflags='-arch armv7 -isysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS5.0.sdk' --enable-pic --enable-decoder=rawvideo --disable-asmmake进行编译。然后将各个.a文件拷贝出来。</p><p>===========================================</p><p>在Xcode4.3环境下有些变化，需要注意isysroot这是我最后调通的参数。。。./configure --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --enable-cross-compile --target-os=darwin --cpu=arm1176jzf-s --arch=arm --extra-cflags='-arch armv6 --sysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk' --extra-ldflags='-arch armv6 -isysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk'</p><p>===========================================</p><p>1.下载:在终端中输入：git clone git://github.com/lajos/iFrameExtractor.git注：该文件包中包含ffmpeg库以及demo。2.编辑:打开iFrameExtractor文件夹下ffmpeg中的 build_armv6和build_armv7,修改./configure后面的参数,主要是SDK版本.我的是4.3,修改为:./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --enable-cross-compile --arch=arm --target-os=darwin --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --cpu=arm1176jzf-s --extra-cflags='-arch armv6' --extra-ldflags='-arch armv6'3. 编译:出错,提示:/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc is unable to create an executable file.C compiler test failed.查看config.err文件,最后提示:ld: file not found: /usr/lib/system/libcache.dylib for architecture armv7collect2: ld returned 1 exit status4. 重新修改build_armv7中的configure参数为:./configure --disable-doc --disable-ffmpeg --disable-ffplay --disable-ffserver --enable-cross-compile --arch=arm --target-os=darwin --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor/gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --cpu=cortex-a8 --extra-cflags='-arch armv7' --extra-ldflags='-arch armv7 -isysroot /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk' --enable-pic5. 编译:build_armv7最后生成静态库,在lib目录和armv7目录.注：build_armv7不能运行，则将该文件的每个命令直接在终端中运行。6.用xcode(我的是4.0版本)打开iFrameExtractor.xcodeproj,现在编译会出错,需要修改几个地方:左边选中工程,中间选中target,右面选中Build settings,在Architectures选项卡里面选择Architetures为Optimized(armv7),Base SDK为LatestiOS(iOS 4.3) Valid Architectures填写armv7.编译目标选择iOS Device,当然,如果有连接电脑的设备,可以选择设备.编译,提示:Undefined symbols for architecture armv7: "_BZ2_bzDecompressInit", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o) "_BZ2_bzDecompressEnd", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o) "_BZ2_bzDecompress", referenced from:   _matroska_decode_buffer in libavformat.a(matroskadec.o)添加库libbz2.1.0.dylib,再次编译,OK通过.以下步骤可以忽略：7. 修改了ffmpeg版本到最新版(0.7),编译的时候需要把common.mak复制到新版本目录.编译的时候遇到错误:ERROR: .endm without .macro at /usr/local/bin/gas-preprocessor.pl line 83, &lt;ASMFILE&gt; line 55用老版本的libavcodec/arm/asm.S和libavcoec/arm/dsputil_arm.S覆盖新版本(实际上我怀疑只覆盖asm.S即可),重新编译即可.原文地址：http://blog.csdn.net/tsingien/article/details/6457246ARM6如果遇到错误不如试试下面的config./configure --cc=/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc --as='gas-preprocessor.pl /Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc' --sysroot=/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk --extra-ldflags=-L/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS4.3.sdk/usr/lib/system --target-os=darwin --arch=arm --cpu=arm1176jzf-s --extra-cflags='-arch armv6' --extra-ldflags='-arch armv6' --enable-pic --enable-cross-compile --disable-ffmpeg --disable-ffplay --disable-ffserver --disable-doc --disable-ffprobe我的FFMPeg版本："SVN-r4"</p><p>===========================================</p><h1 id="subject_tpc">倾情奉献ios5.0编译ffmpeg，真机ok！

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>