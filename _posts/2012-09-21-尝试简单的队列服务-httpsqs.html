---
layout: post
title: 尝试简单的队列服务 HTTPSQS
---

<p>一、下载&amp;编译&amp;安装</p><p>注意：若在ubuntu下make和make install前别忘了加上sudo</p><p>说明：安装TC进行configure时，可能会缺少libbz2包，需要先安装</p><p>sudo apt-get install checkinstall build-essential libbz2-dev （ubuntu下）</p><p>详细步骤：</p><p>1、安装libevent</p><blockquote><p>wgethttps://github.com/downloads/libevent/libevent/libevent-2.0.15-stable.tar.gz tar zxvf libevent-2.0.15-stable.tar.gz cd libevent-2.0.15-stable/ ./configure --prefix=/usr make make install cd ../</p></blockquote><p>2、安装键值数据库TokyoCabinet</p><blockquote><p>wget http://httpsqs.googlecode.com/files/tokyocabinet-1.4.47.tar.gz</p><p>tar zxvf tokyocabinet-1.4.47.tar.gzcd tokyocabinet-1.4.47/./configure --prefix=/usr/local/tokyocabinet-1.4.47/#注：在32位Linux操作系统上编译Tokyo cabinet，请使用./configure --enable-off64代替./configure，可以使数据库文件突破2GB的限制。#./configure --enable-off64 --prefix=/usr/local/tokyocabinet-1.4.47/makemake install</p></blockquote><p>3、安装队列服务程序HTTPSQS</p><blockquote><p>wget http://httpsqs.googlecode.com/files/httpsqs-1.7.tar.gz</p><p>tar zxvf httpsqs-1.7.tar.gz cd httpsqs-1.1/ make make install cd ../</p></blockquote><p>二、相关准备说明</p><p>查看队列服务程序帮助：</p><p>httpsqs -h</p><blockquote><p>-l &lt;ip_addr&gt; 监听的IP地址，默认值为 0.0.0.0 -p &lt;num&gt; 监听的TCP端口（默认值：1218）-x &lt;path&gt; 数据库目录，目录不存在会自动创建（例如：/opt/httpsqs/data）-t &lt;second&gt; HTTP请求的超时时间（默认值：1） -d 以守护进程运行-h 显示这个帮助</p></blockquote><p>使用范例：</p><blockquote><p>ulimit -SHn65535httpsqs -d -p 1218-x /data0/queue</p><p>or with auth password:</p><p>ulimit -SHn65535</p><p>httpsqs -d -p 1218-x /data0/queue -a mypass123</p></blockquote><p>终止进程：</p><p>请使用命令&ldquo;killall httpsqs&rdquo;、&ldquo;pkill httpsqs&rdquo;和&ldquo;kill httpsqs的进程ID&rdquo;来停止httpsqs。</p><p>三、使用说明</p><p>注意：无需apache等httpd服务，使用curl和浏览器即可</p><p>若shell尚未安装curl，则需sudo apt-get install curl（ubuntu下）</p><p>curl方式测试范例：</p><p>1、入队列：</p><p>【GET方式】curl "http://host:port/?name=your_queue_name&amp;opt=put&amp;data=经过URL编码的文本消息"</p><p>【POST方式】curl -d "经过URL编码的文本消息" "http://host:port/?name=your_queue_name&amp;opt=put"</p><p>2、出队列</p><p>curl "http://host:port/?charset=utf-8&amp;name=your_queue_name&amp;opt=get"</p><p>3、查看队列状态</p><p>curl http://host:port/?name=your_queue_name&amp;opt=status</p><p>四、编写自动启动脚本</p><pre> 1 #!/bin/bash 2 # httpsqs shell 3 # author stdanny 4 # version v0.1 5 ############################################ 6   7 case "$1" in 8 start) 9 echo -n "Starting httpsqs&hellip;"10 ulimit -SHn 6553511 httpsqs -d -p 1218 -x /data0/queue -a mypass12312 cd /usr/bin13 echo "start httpsqs Ok!"14 ;;15 stop)16 echo -n "Stoping httpsqs&hellip;"17 killall httpsqs18 echo -n "Stop httpsqs Ok!"19 ;;20 *)21 echo "Usage: $0          {start|stop}"22 esac23 exit 0</pre>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>