---
layout: post
title: 【转】AVAudioPlayer播放音乐，最清晰明了
---

<p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">在xcode中手动添加frameWork。</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">#import"MusicViewController.h"</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">#import&lt;AVFoundation/AVFoundation.h&gt;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">#import&lt;AudioToolbox/AudioToolbox.h&gt;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@implementationMusicViewController</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@synthesizestart;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@synthesizepause;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@synthesizerestart;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@synthesizeBT1;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@synthesizeplayer;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">-(IBAction)tostart:(id)sender{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[playerplay]; //播放</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">AudioSessionSetActive(true);</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">-(IBAction)topause:(id)sender{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[self.playerpause];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">AudioSessionSetActive(false);//要引入tool包才行，不然报错</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">- (void)dealloc</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[BT1release];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[superdealloc];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">- (void)didReceiveMemoryWarning</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// Releases the view if it doesn't have a superview.</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[superdidReceiveMemoryWarning];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// Release any cached data, images, etc that aren't in use.</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">#pragma mark - View lifecycle</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// Implement viewDidLoad to do additional setup after loading the view, typically from a nib.</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">- (void)viewDidLoad</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">NSString*musicFilePath = [[NSBundle mainBundle]pathForResource:@"audio"ofType:@"mp3"];//创建音乐文件路径</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">NSURL* musicURL= [[NSURLalloc]initFileURLWithPath:musicFilePath]; </p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">AVAudioPlayer*thePlayer=[[AVAudioPlayer alloc]initWithContentsOfURL:musicURLerror:nil];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">//创建播放器</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">self.player= thePlayer;//赋值给自己定义的类变量</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[musicURLrelease];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[thePlayerrelease];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[playersetVolume:1]; //设置音量大小0-1之间</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">player.numberOfLoops=-1;//设置音乐播放次数-1为一直循环</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[superviewDidLoad];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">-(void)viewDidUnload//内存警告时才会释放，当前的viewController即使出现内存警告，也不会unload</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[selfsetBT1:nil];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">[superviewDidUnload];</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// Release any retained subviews of the main view.</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// e.g. self.myOutlet = nil;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">// Return YES for supported orientations</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">return(interfaceOrientation ==UIInterfaceOrientationPortrait);</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">@end</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">------------------------------------------------------------------</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">运行出来效果（这个就是你在IB里面以绑定事件就行）</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">PS:这里有几个问题需要说明以下</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">1. 这个[player play] 和【player pause】 时AVAudioPlayer自带的方法，默认情况下你暂停后，再play他会接着你刚才那个继续放，原因时这个play再这个view没有被dealloc之前 ，对象一直没有被销毁。</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">2.使用slider 当音控调教装置</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">代码很简单</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">-(IBAction) volumeChange:(id) sender{</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">self.player.volume=volumebar.value;</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">}</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">/////////////////////////////////////////////</p><p>　iPhone应用轻松使用AVAudioPlayer音频播放是本文要介绍的内容，iPhone SDK中的AVFoundation框架包括的AVAudioPlayer是一个容易使用而且功能强大，基于Object-c的播放音频文件播放器。本教程展示了怎样使用AVAudioPlayer。本教程将建立一个简单的程序，它能够循环播放一段mp3音频文件。</p><p>　　源代码/Guithub</p><p>　　教程的源代码在GitHub上。你可以从仓库中克隆或直接下载zip文件。</p><p>　　创建项目</p><ol class="dp-xml"><li class="alt">LaunchXcodeandcreateanewView-BasediPhoneapplicationcalledAudioPlayer:</ol><p>　　启动Xcode并创建一个&ldquo;View-Based iPhone application&rdquo;项目，取名为AudioPlayer:</p><p>　　1.从Xcode菜单选择&ldquo;File &gt; New Project &hellip;&rdquo;</p><p>　　2.从&ldquo;iPhone OS &gt; Application&rdquo;部分选择&ldquo;View-based Application&rdquo;，然后按&ldquo;Choose&hellip;&rdquo;</p><p>　　3.将项目命名为&ldquo;AudioPlayer&rdquo;并按&ldquo;Save&rdquo;   添加AVFoundation框架</p><p>　　为使用SDK的AVAudioPlayer类，我们需要将AVFoundation框架加入项目：</p><p>　　1.在项目的&ldquo;Groups &amp; Files&rdquo;面板上，展开&ldquo;Targets&rdquo;</p><p>　　2.Control+点击或右击AudioPlayer</p><p>　　3.选择&ldquo;Add &gt; Existing Frameworks&hellip;&rdquo;</p><p>　　4.点击Linked Libraries下左下方的+按钮</p><p>　　5.选择&ldquo;AVFoundation Framework&ldquo;并按Add</p><p>　　6.&ldquo;AVFoundation framewoks&rdquo;将出现在&ldquo;Linked Libraries&rdquo;下，关闭窗口  下面，我们将引入AVFoundation的头文件</p><p>　　1.展开项目&ldquo;Group &amp; Files&rdquo;面板下AudioPlayer项目</p><p>　　2.打开Classes文件夹</p><p>　　3.选取AudioPlayerViewController.h进行编辑</p><p>　　4.更改文件。更改以下粗体字部分：</p><ol class="dp-xml"><li class="alt">#import&lt;UIKit/UIKit.h&gt;#import&lt;AVFoundation/AVFoundation.h&gt;<li class="alt">@interfaceAudioPlayerViewController:UIViewController <li class="alt">{ AVAudioPlayer*audioPlayer; <li class="alt">} @end</ol><p>　　添加音频文件</p><p>　　我们需要一段音频文件来进行播放。文件为audiofie.mp3。我们将其加入项目中：</p><p>　　按Control再左击或右击项目的&ldquo;Group &amp; Files&rdquo;面板中的&ldquo;Resources&rdquo;文件夹</p><p>　　从上下文菜单中选取&ldquo;Add &gt; Existing Files&hellip;&rdquo;</p><p>　　找到并选择要导入的音频文件，按&ldquo;Add&rdquo;</p><p>　　（有必要的话）选定&ldquo;Copy items into destination group&rsquo;s folder&rdquo;方框并按&ldquo;Add&rdquo;</p><p>　　开始播放音频</p><p>　　我们在ViewDidLoad中启动音频播放:</p><p>　　1.解除ViewDidLoad方法的注解</p><p>　　2.更改如下，见粗体部分：</p><ol class="dp-xml"><li class="alt">-(void)viewDidLoad <li class="alt">[superviewDidLoad]; <li class="alt">NSURL*url=[NSURLfileURLWithPath:[NSString stringWithFormat:@"%@/audiofile.mp3",[[NSBundlemainBundle]resourcePath]]]; <li class="alt">NSError*error; audioPlayer=[[AVAudioPlayeralloc]initWithContentsOfURL:urlerror:&amp;error]; <li class="alt">audioPlayer.numberOfLoops=-1; if(audioPlayer==nil) <li class="alt">NSLog([errordescription]); else <li class="alt">[audioPlayerplay];</ol><p>　　AVAudioPlayer是通过URL初始化的，所以我们首先要创立一个指向资源文件夹中音频文件的URL。将音频播放器的numberOfLoops属性设为负数使得播放无限循环。配置好音频播放器后，我们向播放器对象发送播放消息来启动播放。</p><p>　　记住在dealloc方法中释放audioPlayer。改变见粗体部分：</p><ol class="dp-xml"><li class="alt">-(void)dealloc <li class="alt">[audioPlayerrelease]; [superdealloc]; <li class="alt">}</ol><p>　　更多功能</p><p>　　你可以调节播放器音量，查看/设定播放的时间，暂停或停止播放：</p><ol class="dp-xml"><li class="alt">audioPlayer.volume=0.5;//0.0-novolume;1.0fullvolume NSLog(@"%fsecondsplayedsofar",audioPlayer.currentTime); <li class="alt">audioPlayer.currentTime=10;//jumptothe10secondmark [audioPlayerpause]; <li class="alt">[audioPlayerstop];//DoesnotresetcurrentTime;sendingplayresumes</ol><p>　　最后，你还可以实现AVAudioPlayer Delegate协议,比如说，在音频播放结束时得到通知，这样你有可能移动到播放列表的下一首歌。</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">然后自己把事件一绑定就行</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;"></p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">/////////////////////////////////////</p><p style="margin: 0px 0px 5px; padding: 0px; border-width: 0px; list-style-type: none; word-wrap: normal; line-height: 21px;">另一篇更详细的文章，见：http://www.oschina.net/question/213217_40638</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>