---
layout: post
title: 类魔兽世界 技能 天赋 成就 log 系统设计
---

<p> 狭义来讲，技能就是几个人作战时，可以对他人使用产生一定效果的操作。魔兽世界对技能定义进行了扩展，即在魔兽世界中，产生一定效果的任何操作都是技能。例如 吃面包，使用物品，采矿，训练商业技能 等等。</p>  <p>魔兽世界中技能可以产生一个立即的效果（例如 扣血，扣篮，挖到一个矿），或者是一个持续的状态（buff），或者两者兼而有之。立即效果处理起来比较简单这里就不细说了，这里主要说说程序中buff怎样处理。</p>  <p>魔兽世界中buff简直是千变万化，估计没有人能完全的了解所有的buff的效果。这其中有很多种分类，例如                              <p>类型</p>                              <p>例子</p>                                            <p>影响数值型</p>                              <p>奥术智慧，邪甲术</p>                                            <p>控制型</p>                              <p>变羊术 恐惧</p>                                            <p>持续伤害型</p>                              <p>腐蚀术</p>                                            <p>被动触发型</p>                              <p>荆棘术</p>                                            <p>加强效果型</p>                              <p>法师的冲击天赋</p>                                            <p>......</p>                              <p>......</p>                      </p>  <p>很显然，暴雪的开发人员不可能一个一个技能去编写。那不仅难以控制代码，策划也无法脱离程序员去实现技能。其实我们根据破解魔兽世界的客户端，可以看到，魔兽的技能是一个一个配置出来的！程序员只需要做好基本的效果，之后技能就交给策划去配置了。</p>  <p>咋一看，buff种类太多，看上去让人头大。其实可以分解出一个共有的特点：buff是由三个部分组成的： 1. 时间 2. 条件 3. 动作。</p>  <p>我们分析一下上面5种类型的buff这三个特点：                              <p>技能</p>                              <p>时间</p>                              <p>条件</p>                              <p>动作</p>                                            <p>奥术智慧</p>                              <p>加减buff时</p>                              <p>本次加的buff</p>                              <p>加减智力数值</p>                                            <p>变羊术</p>                              <p>加减buff时</p>                              <p>本次加的buff</p>                              <p>变形，减buff 还原</p>                                            <p>腐蚀术</p>                              <p>该buff时间间隔到的时候</p>                                        <p>扣血</p>                                            <p>荆棘术</p>                              <p>被打时</p>                              <p>1.近战攻击 2.命中</p>                              <p>对攻击敌人释放攻击技能</p>                                            <p>法师的冲击天赋</p>                              <p>打中时</p>                              <p>1.火焰魔法 2.命中 3. %2 几率roll成功</p>                              <p>对目标释放一个晕技能</p>                        </p>  <p>一个动作可以是具体效果，也可以是释放一个技能 </p>      <p>上面几个技能触发时机如下图所示：</p>    <p>我们可以发现，在整个技能流程中buff作用效果可以穿插在一些时间点。所以我们可以这样设计配置文件：                              <p>技能id</p>                              <p>时间点</p>                              <p>条件</p>                              <p>动作</p>                                            <p>奥术智慧id</p>                              <p>1，2</p>                              <p>5</p>                              <p>1，2</p>                                            <p>变羊id</p>                              <p>1，2</p>                              <p>5</p>                              <p>3，4</p>                                            <p>腐蚀术id</p>                              <p>3</p>                                        <p>5</p>                                            <p>荆棘术id</p>                              <p>4</p>                              <p>1 and 2</p>                              <p>6</p>                                            <p>冲击id</p>                              <p>5</p>                              <p>3 and 2 and 4</p>                              <p>6</p>                      </p>  <p>这里给出具体含义：</p>  <p>时间点：</p>  <p>1 加buff时</p>  <p>2 减buff时</p>  <p>3 buff tick到时</p>  <p>4 被打时</p>  <p>5 打人时</p>  <p>条件：</p>  <p>1 技能是近战</p>  <p>2 技能命中</p>  <p>3 技能是火焰魔法</p>  <p>4 几率roll成功</p>  <p>5 本次技能施放的buff</p>  <p>动作</p>  <p>1 加智力</p>  <p>2 减智力</p>  <p>3 变形</p>  <p>4 变形还原</p>  <p>5 扣血</p>  <p>6 释放一个技能</p>    <p>时间点的使用</p>  <p>服务器端怎么使用这些配置呢？很简单，服务器上提供一个钩子列表即可,配置文件中，时间点就是钩子的挂载点</p>  <p>vector&lt;boost::signals2::signal&gt;</p>  <p>比如荆棘术buff加上时，根据配置注册到事件的vector相应位置，下标就是时间点</p>  <p>一旦有人被攻击，就会执行下标为4 的所有事件</p>  <p>一旦攻击 就会执行，下标为5的所有事件</p>    <p>条件的扩展</p>  <p>魔兽世界中，buff触发的条件是极其复杂的。例如上面冲击天赋触发条件涉及到三个小条件。这还是比较简单，条件与条件之间只有and关系。如果有or关系怎么办？我们可以用一棵行为树解决这个问题，行为树可以实现and和or的关系。所以完全可以让程序员开发策划需要的condition节点，策划使用编辑器编辑行为树即可。行为树在此就不细说了，大家可以找google看看</p>      再说天赋成就和LOG系统  <p>看到这里，大家也明白了成就系统无非也是三点1. 时间 2. 条件 3. 动作</p>  <p>比如坐骑成就：                              <p>成就id</p>                              <p>时间点</p>                              <p>条件</p>                              <p>动作</p>                                            <p>收集50个坐骑</p>                              <p>收到一个坐骑时</p>                              <p>有50个坐骑</p>                              <p>增加一个坐骑大师的称号</p>                      </p>  <p>LOG也是一样：                              <p>Log</p>                              <p>时间点</p>                              <p>条件</p>                              <p>动作</p>                                            <p>记录一次转移金币大于1000G的LOG </p>                              <p>扣钱</p>                              <p>数量&gt; 1000</p>                              <p>记录log</p>                      </p>    <p>魔兽世界天赋就是一些隐藏的永久buff</p><p>顺便给出一个简单实现：</p><p>https://github.com/egametang/Egametang/tree/master/Cpp/Game/BehaviorTree</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>