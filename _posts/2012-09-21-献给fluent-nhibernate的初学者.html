---
layout: post
title: 献给Fluent NHibernate的初学者
---

<p>12月份项目比较忙，周末都给占了。今天终于算是比较清闲了。之前因为在DevText项目中使用Fluen NHibernate，顺便就学习了下。今天就结合官方网站的介绍来给大家分享下为什么我们要用Fluent NHibernate。</p><p>1.Fluent NHibernate是什么？</p><p>Fluent NHibernate提供了一个方法让你不再需要去写NHibernate的标准映射文件(.hbm.xml)，而是可以把你的映射文件都使用C#来写。这样做，方便了我们的代码重构，提供了代码的易读性，并精简了项目代码。</p><p>它还包含了如下几个工具：</p><p>Fluent NHibernate是NHibernate核心代码的扩展，完全兼容NHibernate2.X。</p><p>2.为什么要Fluent NHibernate?</p><p>NHibernate就不用说了，大家都知道是一个好的ORM工具，它的mapping都是以XML格式定义的。每个类都有一个mapping文件映射到数据库对应的表。 Fluent NHibernate取消了这些xml文件。</p><p>为什么要取代XML文件呢？</p><p>a.XML不是实时编译的。当你的XML配置文件有错误时，你只有在运行时才能看到哪里出错。</p><p>b.XML是非常繁琐的。的确在NHibernate中的配置文件，xml节点非常简单，但是仍然掩盖不了XML文件本身的繁琐性。</p><p>c.映射文件中重复的属性设置。比如在xml中我们需要设置每个string类型的字段都不允许为空，长度大于1000，int型都得有个默认值为-1,这样最终的xml配置文件你会发现有很多的重复工作。</p><p>Fluent NHibernate如何克服这些缺陷呢？ </p><p>Fluent NHibernate把这些配置为文件都转化为了C#代码，这样可以让你的mapping直接在编译时就完成。</p><p>下面是传统的HBM XML mapping文件和Fluent NHibernate的对比。</p><p>Fluent NHibernate的下载地址：</p><p>http://github.com/jagregory/fluent-nhibernate </p><p>3.使用Fluent NHibernate的例子</p><p>前面只是大致的说明了为什么要用Fluent NHibernate。现在我们来模拟一个场景，看看如何在项目中使用Fluent NHibernate。</p><blockquote><p>我们场景中有Employee, Store何Product这几个实体，product和Store之间是多对多的关系。</p></blockquote><p>实体的类如下：</p><p>Employee:</p><p>Product:</p><p>Store:</p><p>如果是使用NHibernate,那么接下来我们只能配置痛苦的XML文件，不过用FLuent NHibernate我们就不需要写配置文件了，只需要简单的写C#代码就OK了。</p><p>说实话这个和CTP4中的mapping方式特像。</p><p>先来看看Employee的mapping文件：</p><p>很明显这里的Map方法相当于XML配置文件的Property,而Reference相当于Many-To-One。</p><p>Product的Mapping如下：</p><p>这里的HasManyToMany相当于NHibernaet中的Many-To-Many。</p><p>4.下一步是创建数据库和SessionFactory:</p><p>创建一个数据库：</p><p>SessionFacotry:</p><p>这里的数据库连接我使用的是直接输入Server,db,username,pwd等，FluentNHibernate还支持其它各种数据库连接形式：</p><p>最后是添加记录：</p><p>运行程序，数据库中表会自动创建，且数据添加成功。</p><p>参考： http://wiki.fluentnhibernate.org/Getting_started#Your_first_project</p><p> http://wiki.fluentnhibernate.org/Database_configuration</p><p> http://wiki.fluentnhibernate.org/Fluent_configuration</p><p>Nick</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>