---
layout: post
title: Android ROM开发--ubuntu下载、编译CyanogenMod7
---

<p> CyanogenMod是一个开源的基于Android操作系统，也就是大家经常刷机用的CM，至于如何刷机以及如何编译google原生的Android。</p><p>可以参考我的iteye博客：http://hualang.iteye.com/admin/categories/166795</p><p>在此，有意个建议。如果是做Android开发的最好还是用google亲生的手机作为测试机（nexus one、nexus s、nexus prime），因为这些机型不仅性能强大，支持原生操作系统，还支持很多其他机型目前还没有的功能（比如我的HTC desire z不支持NFC），另外如果想刷机也可以找到n个版本。而其他机型总是存在这样那样的问题，做开发遇到基于其他机型的问题时也难以找到合适的答案，闲话不说了。</p><p>我博文是关于如何下载、编译CyanogenMod，以及如何自定义自己的ROM系列，比如我们比较熟悉的小米手机的MIUI就是基于CyanogenMod。但是因为自己换了不同手机，所以以前基于Nexus S的一些操作不适合于现在的机型了，但是大概流程是一样的。在这里最最麻烦的不是下载源码，而是--编译CyanogenMod。各种各样的问题，每一次编译都要至少1、2个小时，我话费了5天来编译源码，期间遇到各种各样的问题，随着一点一点的查询也逐个的解决了，今天终于编译成功、刷机成功了。</p><p>机型：HTC desire z（HTC vision）</p><p>Android源码：CyanogenMod 7（下载的最新的CM源码2.3.7编译还有问题，所以用的是稍微老一点2.3.4的）</p><p>电脑：Thinkpad 32位</p><p>系统：Ubuntu 10.10</p><p>问题解决：如果你的机型不是这个，编译的源码版本也不是这个，遇到问题最好还是去外面查查（程序员必备技术，你们懂得），下面是一些对你有帮助的网站</p><p>1、CyanogenMod Wiki。可以根据上面的教程来下载并编译适合你机型的CM</p><p>http://wiki.cyanogenmod.com/wiki/Main_Page</p><p>2、XDA Developer。遇到技术问题多上上面问，大牛很多</p><p>http://forum.xda-developers.com/index.php</p><p>3、github：如果你编译时缺少某些包，可以到上面找找看</p><p>https://github.com/koush</p><p>4、CyanogenMod官网，用于下载ROM</p><p>http://www.cyanogenmod.com（被墙了,so...）</p><p>在开始之前你需要root你的手机，在www.cyanogenmod.com里找到针对你的机型的ROM下载并刷机。(国内这段时间墙了,so...)</p><p>有关刷机、root等可以到我的iteye博客中找到，也可以到MIUI官网找一些关于刷机的教程</p><p>http://hualang.iteye.com/admin/categories/166795</p><p>下面开始具体的步骤</p>1、安装软件<p>首先需要你安装并配置好Android环境，这个不解释</p><p>For 32-bit &amp; 64-bit systems:</p><p>sudo apt-get install 下面软件列表（如果某些安装有问题，最好一个一个的下载安装）</p><dl><code>git-core gnupg flex bison gperf libsdl1.2-dev libesd0-dev libwxgtk2.6-dev squashfs-tools build-essential zip curl libncurses5-dev zlib1g-dev sun-java6-jdk pngcrush schedtool</code></dl><p>For 64-bit only systems:</p><dl><code>g++-multilib lib32z1-dev lib32ncurses5-dev lib32readline5-dev gcc-4.3-multilib g++-4.3-multilib</code><dl>NOTE: <code>gcc-4.3-multilib g++-4.3-multilib</code> is no longer available for Ubuntu 11.04 64-bit, but should still build without issue.</dl></dl><dl>NOTE:On Ubuntu 10.10, and variants, you need to enable the parter repository to install sun-java6-jdk:<dl><code>add-apt-repository "deb http://archive.canonical.com/ maverick partner"</code></dl></dl><p>Download RomManager</p>2、创建目录<p>在终端中输入下列命令下载并执行repo</p><p>创建一个目录，用于存放源代码</p><p> $mkdir -p cyanogenmod</p><p> $mkdir -p bin</p>3、初始化下载库<p>在终端中输入下列命令下载并执行repo：</p><dl><code>$curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo &gt; ~/bin/repo</code><code>$chmod a+x ~/bin/repo</code><dl>注意:你需要重启电脑来使其生效<code></code></dl><p><code>$chmod a+x ~/bin/repo</code></p></dl>4、下载CyanogenMod源码<p>在终端中输入下列命令下载并执行repo：</p><p>现在输入下列命令来初始化版本库：</p><dl><code>$cd ~/cyanogenmod</code><code>$repo init -u git://github.com/CyanogenMod/android.git -b gingerbread</code><code>$repo sync</code><code>或者repo sync -j16(-jn中的n表示打开的网络连接数，开启多个网络连接可以加速下载速度)</code>出现如下的状态就表示下载完成了（耗时教长，我用的是4M带宽下了3个小时，大小4G多）</dl>5、获取属性文件<p>此时需要将手机通过USB连接到Ubuntu上。如果一开始不知别手机设备的话，可以参考http://www.cnblogs.com/loulijun/archive/2012/01/10/2318316.html来解决</p><p>然后在终端中输入</p><p> $adb devices</p><p>如果显示如下错误的话，可以通过如下命令来解决（以后再遇到就用这种方式解决就是了）</p><p> $sudo adb kill-server</p><p> $sudo adb devices</p><dl><code>$cd ~/cyanogenmod/device/htc/vision/</code><code>$./extract-files.sh</code>NOTE: 注意，如果你获取文件的时候缺少某些如照相机或radio等文件时，你可以到上面的网站找找是否你需要的文件</dl>6、下载 RomManager<dl><code>$cd ~/android/system/vendor/cyanogen/</code>$./get-rommanager</dl>7、编译CyanogenMod<p>编译源码</p><p>编译源码之前，因为源码默认设置是在64位机编译的，所以你需要修改其为32位即可</p><p>------------------------------64位改为32位方法-----------------------------------------------------</p><p>build/core/main.mk:73: You are attempting to build on a 32-bit system. build/core/main.mk:74: Only 64-bit build environments are supported beyond froyo/2.2. 是因为cm默认只支持64-bit，而我的计算机是32位的，所以需要修改一些文件即可 将 ./external/clearsilver/cgi/Android.mk ./external/clearsilver/java-jni/Android.mk ./external/clearsilver/util/Android.mk ./external/clearsilver/cs/Android.mk 4个文件中的</p><pre class="wiki">LOCAL_CFLAGS += -m64LOCAL_LDFLAGS += -m64</pre><p>注释掉，或者将&ldquo;64&rdquo;换成&ldquo;32&rdquo;</p><pre class="wiki">LOCAL_CFLAGS += -m32LOCAL_LDFLAGS += -m32</pre><p>然后，将./build/core/main.mk 中的 ifneq (64,$(findstring 64,$(build_arch))) 改为： ifneq (i686,$(findstring i686,$(build_arch)))</p><p>这样，32位的计算机也可以正常编译了</p><p>NOTE：最新版本的CM源码没有ifneq(64...)这部分，所以就不许要改了</p><p>-----------------------------------------------------------------------------------------------------------</p><dl><code>$. build/envsetup.sh &amp;&amp; brunch vision</code>编译成功后</dl>8、刷机<p>正常情况下可以刷成功，刷机教程看上面</p>9、编译期间遇到的问题<p>（1）执行.extract-files.sh如果获取手机的属性文件缺少的话，如下图。可以到</p><p>https://github.com/koush/proprietary_vendor_htc/tree/gingerbread/vision/proprietary</p><p>上寻找你缺少的文件，下载后放到</p><p>/home/loulijun/cyanogenmod/vendor/htc/vision/proprietary下即可</p><p>（2）undefined reference to 'msm_device_mute'、libaudio.so错误</p><p>这种错误网上的有些方法依然不能解决，我是换了从cm2.3.7最新的源码为cm2.3.4的。或者关闭audio的编译选项，可以到vendor和device下找到相应的mk文件将设置audio的true设置为false</p><p>（3）undefined reference to 'HAL_getCameraInfo'、libcameraservice错误</p><p>解决办法：</p><p>$cd /cyanogenmod/device/htc/vision</p><p>$vim BoardConfig.mk</p><p>将BOARD_USE_FROYO_LIBCAMERA := false（设置为false）</p><p>$cd /cyanogenmod/vendor/htc/vision/</p><p>$vim BoardConfigVendor.mk</p><p>将USE_CAMERA_STUB设置为false（这样编译就好了）</p><p>另外还可以参考</p><p>http://forum.xda-developers.com/showthread.php?t=899674</p><p>里面有解决camera问题的方法（如果上述不奏效的话），不过上面是基于nexus one的，原理一样</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>