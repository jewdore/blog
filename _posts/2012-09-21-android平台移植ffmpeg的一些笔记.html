---
layout: post
title: Android平台移植ffmpeg的一些笔记
---

<p>Copy from http://blog.csdn.net/piaozhiye/archive/2011/04/26/6363512.aspx</p><p>是在http://blog.csdn.net/moruite/archive/2011/04/06/6305944.aspx基础上做的编译移植过程，主要做一些记录。</p><p>首先：</p><p>是要编译libjnivideo.so和libjniaudio.so 这两个so因为不同的版本或者修改过的framework是不一样的，所以需要在android源码中 编译出自己的so。我的android 2.1源码是从官网下载回来的，没有经过修改。</p><p>下载链接中的native目录下的源码到framework/base目录下具体看他的目录结构。https://github.com/havlenapetr/android_frameworks_base</p><p>编译主要有3个错误</p><p>1.</p><p>library 'libjnigraphics.so' not in prelink map</p><p>当前目录下的Android.mk 加上</p><p>LOCAL_PRELINK_MODULE := false</p><p>2.</p><p>frameworks/base/native/video/jni/surface.cpp:17:36: error: surfaceflinger/Surface.h: No such file or directory</p><p>修改头文件</p><p>#include &lt;android/surface.h&gt;</p><p>#include &lt;ui/Surface.h&gt;</p><p>#include &lt;utils/Log.h&gt;</p><p>#include &lt;SkBitmap.h&gt;</p><p>#include &lt;SkCanvas.h&gt;</p><p>3.</p><p>make: *** 没有规则可以创建&ldquo;out/target/product/generic/obj/SHARED_LIBRARIES/libjnivideo_intermediates/LINKED/libjnivideo.so&rdquo;需要的目标&ldquo;out/target/product/generic/obj/lib/libsurfaceflinger_client.so&rdquo;。 停止。</p><p>当前目录下的Android.mk</p><p>LOCAL_SHARED_LIBRARIES := \</p><p>libskia \</p><p> libui \</p><p> libutils \</p><p>liblog</p><p>到这里如果幸运的话可以编译出so。</p><p>其次是编译libffmpeg_jni.so</p><p>需要修改的地方：</p><p>1.</p><p>jni/jni/Android.mk</p><p> LOCAL_C_INCLUDES += \</p><p>$(LOCAL_PATH)/../libffmpeg \</p><p>$(LOCAL_PATH)/../libmediaplayer \</p><p>$(LOCAL_PATH)/../include \</p><p>$(LOCAL_PATH)/../include/android</p><p>ifeq ($(IN_NDK),true) </p><p>LOCAL_LDLIBS := -llog</p><p>else</p><p>LOCAL_PRELINK_MODULE := false</p><p>LOCAL_LDLIBS := -llog</p><p>LOCAL_SHARED_LIBRARIES := liblog</p><p>endif</p><p>2.</p><p>Vector.h</p><p>#include &lt;new&gt;</p><p>#include &lt;stdint.h&gt;</p><p>#include &lt;sys/types.h&gt;</p><p>#include &lt;cutils/log.h&gt;</p><p>#include &lt;utils/VectorImpl.h&gt;</p><p>#include &lt;utils/TypeHelpers.h&gt;</p><p>#include &lt;android/Errors.h&gt;</p><p>3.</p><p>&lt;utils/TypeHelpers.h&gt;</p><p>4</p><p>VectorImpl.h</p><p>#include &lt;assert.h&gt;</p><p>#include &lt;stdint.h&gt;</p><p>#include &lt;sys/types.h&gt;</p><p>#include &lt;android/Errors.h&gt;</p><p>5.</p><p>VectorImpl.cpp</p><p>#include &lt;string.h&gt;</p><p>#include &lt;stdlib.h&gt;</p><p>#include &lt;stdio.h&gt;</p><p>#include &lt;cutils/log.h&gt;</p><p>#include &lt;android/Errors.h&gt;</p><p>#include &lt;utils/SharedBuffer.h&gt;</p><p>#include &lt;utils/VectorImpl.h&gt;</p><p>同时也要把刚才两个编译出来的so放到obj/local/armeabi目录下，之后就可以了编译出libffmpeg_jni.so.</p><p>最后也要把刚才两个so放到libs/armeabi目录下。要不然运行的时候找不到。</p><p>播放的时候太卡了，声音也没有同步。</p><p>本文来自CSDN博客，转载请标明出处：http://blog.csdn.net/piaozhiye/archive/2011/04/26/6363512.aspx</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>