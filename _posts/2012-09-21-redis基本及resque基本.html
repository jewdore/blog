---
layout: post
title: Redis基本及Resque基本
---

Redis<p>redis是类似于memcached的高性能键值缓存工具，但它支持更多的值类型、功能更加丰富，且可以将存储内容定时持久化到磁盘中，是NoSQL家庭中出色的一员</p>安装<pre>wget https://github.com/antirez/redis/tarball/2.2.0-rc2tar -xzvf antirez-redis-2.2.0-rc2-0-g0540df2.tar.gzcd antirez-redis-b703b5dmakesudo make install</pre>客户端<pre>redis-cli</pre>调试<p>运行客户端后，输入命令</p><pre>monitor</pre>注意expire<p>redis的expire命令有限制，执行此命令后，对key进行的任何操作都将先对key进行清空操作，详见http://redis.io/topics/expire2.1.3以上版本不存在这个限制，但未正式发布稳定版，2.1正式发布时会更改为2.2版本</p><p>具体表现如下:</p><blockquote><p>redis&gt; set a 100OKredis&gt; expire a 600(integer) 1redis&gt; incr a(integer) 1redis&gt; get a&ldquo;1&rdquo; #正常来说，应返回101，因为还key还没有过期</p></blockquote><p>如果对这个限制敏感，可以尝试2.2.0rc2版本<code>make</code>之后最好再执行下<code>make test</code>测试是否正常，我试过，确实不再存在上面说的奇怪表现</p>redis-rb<p>redis支持多语言实现的客户端访问，redis-rb是redis的客户端之一，基于ruby语言实现。redis-rb中的方法名称与redis的一致</p>Resque<p>resque是基于redis的后台任务组件，能把任何类或模块作为任务在后台执行，且自带前台管理功能，方便查看执行情况。</p>使用<p>1. 编写任务</p><pre>class WorkerClass  @queue = "demo"  def self.perform(args)    sleep 3     puts "Doing something complex with  #{args}"  endend</pre><p>2. 进入任务队列</p><pre>require "resque"Resque.enqueue(WorkerClass, args)</pre><p>3. 运行任务</p>与rails3整合<p>0. 配置redis新增<code>config/redis.yml</code>文件，加入以下内容</p><pre>defaults: &amp;defaults  host: localhost  port: 6379development:  &lt;&lt;: *defaultstest:  &lt;&lt;: *defaultsstaging:  &lt;&lt;: *defaultsproduction:  &lt;&lt;: *defaults</pre><p>1. 加载resque</p><pre>echo "require 'resque'" &gt; config/initializers/load_resque.rbconfig = YAML::load(File.open("#{Rails.root}/config/redis.yml"))[Rails.env]Resque.redis = Redis.new(:host =&gt; config['host'], :port =&gt; config['port'])</pre><p>2. 由于worker类都放在app/jobs，因此需要指定rails加载此目录修改<code>config/application.rb</code>，加入以下内容</p><blockquote><p>config.autoload_paths += %W(#{config.root}/app/jobs)</p></blockquote><p>3. 加入rake任务修改 @RakeFile@，加入以下内容</p><blockquote><p>require &lsquo;resque/tasks&rsquo;task &ldquo;resque:setup&rdquo; =&gt; :environment</p></blockquote><p>第二句指明运行<code>resque:setup</code>前先初始化rails环境</p>运行resque后台任务<pre>QUEUE=* rake resque:work</pre>查看任务执行情况<pre>#运行resque前台管理服务器resque-web -p 8282</pre><p>打开浏览器，访问http://0.0.0.0:8282前台可以查看失败的worker及其日志，可以手动执行retry操作</p>定时任务<p>如需定时执行任务，可以使用resque-scheduler</p>测试<p>在测试的时候我们不需要测试过程与resque是异步的,否则resque执行的时候数据可能已经被清空了,使用resque_spec插件可以让resque worker立即执行</p><p>详情查看https://github.com/leshill/resque_spec</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>