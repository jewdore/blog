---
layout: post
title: posabsolute-jQuery-Validation-Engine使用总结
---

<p class="p0">posabsolute-jQuery-Validation-Engine使用总结</p><p class="p0">下载地址</p><p class="p0">https://github.com/posabsolute/jQuery-Validation-Engine</p><p class="p0">这个是我在做CMS时找到的一个jquery插件，自己看了作者的使用手册，记录一下自己的使用心得。</p><p class="p0"></p><p class="p0">css目录：是插件用到的显示样式需要的css文件所在文件夹</p><p class="p0">demos目录：是相关demo，例子</p><p class="p0">js目录:是一些核心的js文件</p><p class="p0">rundemo.bat是作者写的测试程序windows下的，我运行了，但是报错。我没查找原因，以后再看</p><p class="p0">rundemo.sh是linux下的测试程序</p><p class="p0">第一步在表单页面引入相应的文件</p><p class="p0">&lt;scriptsrc="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"type="text/javascript"&gt;&lt;/script&gt;</p><p class="p0">或者导入本地的jquery.js</p><p class="p0">&lt;scripttype="text/javascript"src="js/jquery-1.6.min.js"&gt;&lt;/script&gt;</p><p class="p0">第二步引入本地化文件和验证引擎</p><p class="p0">下面是本地化文件，我们用中文那就引入js/jquery.validationEngine-zh_CN.js</p><p class="p0">&lt;scriptsrc="js/jquery.validationEngine-en.js"type="text/javascript"charset="utf-8"&gt;&lt;/script&gt;</p><p class="p0">下面这个是验证核心文件</p><p class="p0">&lt;scriptsrc="js/jquery.validationEngine.js"type="text/javascript"charset="utf-8"&gt;&lt;/script&gt;</p><p class="p0">最后引入规则样式</p><p class="p0">&lt;linkrel="stylesheet"href="css/validationEngine.jquery.css"type="text/css"/&gt;</p><p class="p0"></p><p class="p0"></p><p class="p0"></p><p class="p0">下面开始举例，我们模拟一个表单form提交到一个servlet中，判断提交的验证码是否正确。如果正确就</p><p class="p0">跳转到主页，否则提示验证码错误。</p><p class="p0">第一步。我们需要几个工具类</p><p class="p0">//AjaxValidationFormResponse这个类用来存储验证信息和负责把验证信息转换成json格式。是作者demo中提供的</p><p class="p0">publicclassAjaxValidationFormResponse{</p><p class="p0"></p><p class="p0">//thehtmlfieldid</p><p class="p0">privateStringid;</p><p class="p0"></p><p class="p0">//true,thefieldisvalid:theclientlogicdisplaysagreenprompt</p><p class="p0">//false,thefieldisinvalid:theclientlogicdisplaysaredprompt</p><p class="p0">privateBooleanstatus;</p><p class="p0"></p><p class="p0">//eitherthestringtodisplayinthepromptoranerror</p><p class="p0">//selectortopicktheerrormessagefromthetranslation.js</p><p class="p0">privateStringerror;</p><p class="p0"></p><p class="p0">publicAjaxValidationFormResponse(StringfieldId,Booleans,Stringerr){</p><p class="p0">id=fieldId;</p><p class="p0">status=s;</p><p class="p0">error=err;</p><p class="p0">}</p><p class="p0"></p><p class="p0">publicStringtoString(){</p><p class="p0"></p><p class="p0">StringBufferjson=newStringBuffer();</p><p class="p0">json.append("[\"").append(id).append("\",").append(status).append(",\"").append(error.toString()).append("\"]");</p><p class="p0">returnjson.toString();</p><p class="p0">}</p><p class="p0">}</p><p class="p0">第二部表单</p><p class="p0">&lt;formaction="/cms/LoginServlet"method="get"id="form1"&gt;</p><p class="p0">&lt;inputtype="text"name="code"id="code"value=""/&gt;</p><p class="p0">&lt;/form&gt;</p><p class="p0">效果如图</p><p class="p0"></p><p class="p0">第三部分js代码</p><p class="p0">&lt;script&gt;</p><p class="p0"></p><p class="p0">//这个方法是验证请求执行之前被调用</p><p class="p0">functionbeforeCall(form,options){</p><p class="p0">if(console)</p><p class="p0">console.log("RightbeforetheAJAXformvalidationcall");</p><p class="p0">returntrue;</p><p class="p0">}</p><p class="p0"></p><p class="p0">//这个方法是验证后的回调方法</p><p class="p0">functionajaxValidationCallback(status,form,json,options){</p><p class="p0">if(console)</p><p class="p0">console.log(status);</p><p class="p0"></p><p class="p0">if(status===true){//这里的status是后台返回的json中的true</p><p class="p0">window.location="/cms/main.jsp";//验证成功后重定向到main.jsp页面</p><p class="p0">alert("theformisvalid!");</p><p class="p0">//uncommenttheselinestosubmittheformtoform.action</p><p class="p0">//form.validationEngine('detach');</p><p class="p0">//form.submit();</p><p class="p0">//oryoumayuseAJAXagaintosubmitthedata</p><p class="p0">}</p><p class="p0">}</p><p class="p0"></p><p class="p0"></p><p class="p0">//这个是调用核心方法，formid是你表单的ID我这里是form1</p><p class="p0">jQuery(document).ready(function(){</p><p class="p0">jQuery("#formID").validationEngine({</p><p class="p0">ajaxFormValidation:true,//使用ajax调用</p><p class="p0">onAjaxFormComplete:ajaxValidationCallback,//设置验证后的回调函数</p><p class="p0">onBeforeAjaxFormValidation:beforeCall//设置验证前的调用的函数</p><p class="p0">});</p><p class="p0">});</p><p class="p0"></p><p class="p0">以上是前台代码下面是java代码</p><p class="p0">Stringcheckcode=req.getParameter("code");//接收用户输入的验证码</p><p class="p0">//提取刚刚生成的验证码，使用session存储。验证码生成这里不再细说</p><p class="p0">StringSessioncodes=(String)req.getSession().getAttribute("codes");</p><p class="p0">这里就用到了前面提到的工具里。AjaxValidationFormResponse，使用了泛型</p><p class="p0">ArrayList&lt;AjaxValidationFormResponse&gt;errors=newArrayList&lt;AjaxValidationFormResponse&gt;();</p><p class="p0">if(!Sessioncodes.equalsIgnoreCase(checkcode))</p><p class="p0">{</p><p class="p0">//验证码不正确。跳转到登陆页面//如果验证错这里要用false和checkcode,后面会有解释</p><p class="p0">errors.add(newAjaxValidationFormResponse("code",false,</p><p class="p0">"checkcode"));</p><p class="p0">}</p><p class="p0">else</p><p class="p0">{//如果验证没错误，这里要用true，&ldquo;yougotit&rdquo;这个我拷贝例子里的具体我也不清楚</p><p class="p0">errors.add(newAjaxValidationFormResponse("code",true,</p><p class="p0">"Yougotit!"));</p><p class="p0">}</p><p class="p0"></p><p class="p0">Stringjson="true";//定义一个字符，为啥这是为true我也不知道，照搬开发者的源代码</p><p class="p0">if(errors.size()!=0)//如果链表里有错误转换为json格式数据</p><p class="p0">{</p><p class="p0">json=AjaxValidationFormResponse.genJSON(errors);</p><p class="p0">}</p><p class="p0">resp.getWriter().print(json);</p><p class="p0">============</p><p class="p0">下面这个方法就是把链表转换为字符串，自己可以用jackson或者gson或者别的工具转换，也可以用这个方法，这个是开发者在demo中用到的</p><p class="p0">publicstaticStringgenJSON(ArrayList&lt;AjaxValidationFormResponse&gt;errors){</p><p class="p0">StringBufferjson=newStringBuffer();</p><p class="p0">json.append('[');</p><p class="p0">for(inti=0;i&lt;errors.size();i++){</p><p class="p0"></p><p class="p0">AjaxValidationFormResponseerr=errors.get(i);</p><p class="p0">json.append(err.toString());</p><p class="p0">if(i&lt;errors.size()-1){</p><p class="p0">json.append(',');</p><p class="p0">}</p><p class="p0">}</p><p class="p0">json.append(']');</p><p class="p0">returnjson.toString();</p><p class="p0">}</p><p class="p0">=============</p><p class="p0">以上就是大体代码，整个流程，就是js代码jQuery("#formID").validationEngine，先执行，然后提交到后台验证，不管你验证成功还是失败，都要返回json格式数据，就是把ArrayList&lt;AjaxValidationFormResponse&gt;errors=newArrayList&lt;AjaxValidationFormResponse&gt;();转换成相应的json返回，验证正确就在errors里加入</p><p class="p0">errors.add(newAjaxValidationFormResponse("code",true,"这里先自己随便写"));错误就加入</p><p class="p0">errors.add(newAjaxValidationFormResponse("code",false,"checkcode"));不要验证通过就不加入了，只加入错误的。我就犯了这样的错误，就一直报ajaxerrosparaseerror错误，这个是重点</p><p class="p0">现在说说这里为什么是checkcode,因为在这个的国际化文件里有这个文件</p><p class="p0">js/languages/jquery.validationEngine-zh_CN.js</p><p class="p0">打开</p><p class="p0"></p><p class="p0">看到了吧。我们自己按照他的格式自己添加一个就行</p><p class="p0">然后后台验证返回后resp.getWriter().print(json);然后执行js部分的functionajaxValidationCallback函数</p><p class="p0">当返回中有true时，//newAjaxValidationFormResponse("code",true,"这里先自己随便写")</p><p class="p0">执行</p><p class="p0">if(status===true)//这里的status是后台返回的json中的true</p><p class="p0">window.location="/cms/main.jsp";//验证成功后重定向到main.jsp页面</p><p class="p0"></p><p class="p0">Thinking-c3t总结</p><p class="p0"></p><p class="p0"></p><p class="p0"></p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>