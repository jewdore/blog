---
layout: post
title: mamcached 安装
---

<p>[1]</p><p>http://www.google.com.hk/search?hl=en&amp;safe=active&amp;q=mamcached+%E5%AE%89%E8%A3%85++redhat&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=</p><p>http://www.google.com.hk/search?q=memcache+%E9%85%8D%E7%BD%AE+java&amp;hl=en&amp;safe=active&amp;prmd=ivns&amp;ei=M4mqTY3hJpGiuQPrkp2NCg&amp;start=10&amp;sa=N</p><p>[2]</p><p>http://blog.netboshi.com/?p=444</p><p>memcache和memcached安装过程2011年4月11日jinbo发表评论阅读评论Memcache是什么?　　Memcache是一个自由和开放源代码、高性能、分配的内存对象缓存系统。用于加速动态web应用程序，减轻数据库负载。　　它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个HashTable，Memcached自管理这 些HashTable。　　Memcached又是什么?　　Memcached是Memcache系统的主程序文件，以守护程序方式运行于一个或多个服务器中，随时接受客 户端的连接操作，使用共享内存存取数据。　　那PHP中的Memcache是什么?php中的所讲的memcache是用于连接Memecached的php支持扩展之一(可用phpinfo查看)，类似mbstring，eAccelerator。　　简单的说　　Memcache是总的缓存系统项目名称，容易和PHP中的Memcache混淆。　　我们常提到Memcache其实是PHP中的Memcache，即PHP的Memcached扩展支持。　　我们常提到Memcached是服务端主程序文件，服务端安装程序。　　为了让你的程序飞起来，必须安装memcached服务端程序和PHP的Memcached扩展，所以如果您要使用Memcache来缓存系统，memcache和memcached两样我们都需要安装。　　安装memcache# cd /usr/local/src# wget http://pecl.php.net/get/memcache-2.2.5.tgz# gzip -d memcache-2.2.5.tgz# tar xvf memcache-2.2.5.tar# cd memcache-2.2.5　　以下几句，是以php所在目录为/usr/local/php为例，如果您的php有变化，请自行替换几句中/usr/local/php的部分# /usr/local/php/bin/phpize# ./configure &ndash;enable-memcache &ndash;with-php-config=/usr/local/php/bin/php-config &ndash;with-zlib-dir# make &amp;&amp; make install 　　将memcache加入php扩展　　# vi /etc/php.ini(/etc/php.ini地址为我的php.ini位置，如果你不知道你的php.ini在哪里，可以用# find / -name php.ini进行查找，或者传个探针phpinfo，找到Configuration File (php.ini) Path)中php.ini的位置.　　末尾加入　　按键盘上的 i 开始编辑　　CTRL+F翻页拉到最下面在[Zend]之前加入extension_dir = &ldquo;/usr/local/php/lib/php/extensions/no-debug-non-zts-20060613/&rdquo;extension=memcache.so 　　按Esc键，再输入　　：wq　　保存退出　　重启你的web服务器，比如apache/etc/init.d/httpd restart 　　下面刷新下PHP探针，看下是不是有这个了，有的话就是装好了memcacheVersion  2.2.5memcacheVersion  2.2.5下面安装memcached　　装memcached首先需要安装安装libevent　　如果是centos可以yum安装# yum install libevent-devel 如果不支持yum的系统，可以这样装libevent# cd /usr/local/src# wget http://www.monkey.org/~provos/libevent-1.4.12-stable.tar.gz# tar vxf libevent-1.4.12-stable.tar.gz# cd libevent-1.4.12# ./configure &ndash;prefix=/usr/local/libevent# make &amp;&amp; make install 接续安装memcached# cd /usr/local/src# wget http://cloud.github.com/downloads/saberma/saberma.github.com/memcached-1.4.4.tar.gz# tar vxf memcached-1.4.4.tar.gz# cd memcached-1.4.4# ./configure &ndash;prefix=/usr/local/memcached# make &amp;&amp; make install 安装完后启动memcached并分配32m内存（32为使用内存数，可按自身情况修改）/usr/local/memcached/bin/memcached -d -m 32 -l 127.0.0.1 -p 11211 -u root将memcached加入启动项# vi /etc/rc.d/rc.local 按键盘上的 i 开始编辑在最后加入/usr/local/memcached/bin/memcached -d -m 32 -l 127.0.0.1 -p 11211 -u root 按Esc键，再输入：wq保存退出如果需要，可以reboot一下，不过不用reboot应该已经生效~加速效果测试用没有什么负载的Discuz X1做个测试，未启用时GMT+8, 2010-9-12 09:08, Processed in 0.038893 second(s), 2 queries. 缓存启用后的效果，不过总体感觉VPS上效果不如用eAccelerato缓存加入效果那么明显GMT+8, 2010-9-12 09:08, Processed in 0.008383 second(s), 2 queries, Memcache On. 大功告成，打完收工！~~</p><p>[3]</p><p>http://blog.csdn.net/canduecho/archive/2008/01/31/2074168.aspx</p><p>Memcache是什么 收藏   Memcache是什么Memcache是danga.com的一个项目，最早是为 LiveJournal 服务的，目前全世界不少人使用这个缓存项目来构建自己大负载的网站，来分担数据库的压力。它可以应对任意多个连接，使用非阻塞的网络IO。由于它的工作机制是在内存中开辟一块空间，然后建立一个HashTable，Memcached自管理这些HashTable。Memcache官方网站：http://www.danga.com/memcached，更多详细的信息可以来这里了解  为什么会有Memcache和memcached两种名称？其实Memcache是这个项目的名称，而memcached是它服务器端的主程序文件名，知道我的意思了把~~~~。一个是项目名称，一个是主程序文件名，在网上看到了很多人不明白，于是混用了。Memcache的安装分为两个过程：memcache服务器端的安装和memcached客户端的安装。所谓服务器端的安装就是在服务器（一般都是linux系统）上安装Memcache实现数据的存储所谓客户端的安装就是指php（或者其他程序，Memcache还有其他不错的api接口提供）去使用服务器端的Memcache提供的函数，需要php添加扩展。具体的配置大家可以参考：Linux下的Memcache安装：http://www.ccvita.com/index.php/257.htmlWindows下的Memcache安装：http://www.ccvita.com/index.php/258.htmlMemcache基础教程：http://www.ccvita.com/index.php/259.htmlPHP的Memcache&lt; ?php//连接$mem = new Memcache;$mem-&gt;connect("192.168.0.200", 12000);//保存数据$mem-&gt;set('key1', 'This is first value', 0, 60);$val = $mem-&gt;get('key1');echo "Get key1 value: " . $val ."&lt;br /&gt;";//替换数据$mem-&gt;replace('key1', 'This is replace value', 0, 60);$val = $mem-&gt;get('key1');echo "Get key1 value: " . $val . "&lt;br /&gt;";//保存数组$arr = array('aaa', 'bbb', 'ccc', 'ddd');$mem-&gt;set('key2', $arr, 0, 60);$val2 = $mem-&gt;get('key2');echo "Get key2 value: ";print_r($val2);echo "&lt;br /&gt;";//删除数据$mem-&gt;delete('key1');$val = $mem-&gt;get('key1');echo "Get key1 value: " . $val . "&lt;br /&gt;";//清除所有数据$mem-&gt;flush();$val2 = $mem-&gt;get('key2');echo "Get key2 value: ";print_r($val2);echo "&lt;br /&gt;";//关闭连接$mem-&gt;close();?&gt;如果正常的话，浏览器将输出：Get key1 value: This is first valueGet key1 value: This is replace valueGet key2 value: Array ( [0] =&gt; aaa [1] =&gt; bbb [2] =&gt; ccc [3] =&gt; ddd )Get key1 value:Get key2 value: 程序代码分析初始化一个Memcache的对象：$mem = new Memcache;连接到我们的Memcache服务器端，第一个参数是服务器的IP地址，也可以是主机名，第二个参数是Memcache的开放的端口：$mem-&gt;connect("192.168.0.200", 12000);保存一个数据到Memcache服务器上，第一个参数是数据的key，用来定位一个数据，第二个参数是需要保存的数据内容，这里是一个字符串，第三个参数是一个标记，一般设置为0或者MEMCACHE_COMPRESSED就行了，第四个参数是数据的有效期，就是说数据在这个时间内是有效的，如果过去这个时间，那么会被Memcache服务器端清除掉这个数据，单位是秒，如果设置为0，则是永远有效，我们这里设置了60，就是一分钟有效时间：$mem-&gt;set(&lsquo;key1&lsquo;, &lsquo;This is first value&rsquo;, 0, 60);从Memcache服务器端获取一条数据，它只有一个参数，就是需要获取数据的key，我们这里是上一步设置的key1，现在获取这个数据后输出输出：$val = $mem-&gt;get(&rsquo;key1&prime;);echo "Get key1 value: " . $val;现在是使用replace方法来替换掉上面key1的值，replace方法的参数跟set是一样的，不过第一个参数key1是必须是要替换数据内容的key，最后输出了：$mem-&gt;replace(&lsquo;key1&prime;, &lsquo;This is replace value&rsquo;, 0, 60);$val = $mem-&gt;get(&lsquo;key1&prime;);echo "Get key1 value: " . $val;同样的，Memcache也是可以保存数组的，下面是在Memcache上面保存了一个数组，然后获取回来并输出$arr = array(&lsquo;aaa&rsquo;, &lsquo;bbb&rsquo;, &lsquo;ccc&rsquo;, &lsquo;ddd&rsquo;);$mem-&gt;set(&lsquo;key2&prime;, $arr, 0, 60);$val2 = $mem-&gt;get(&lsquo;key2&prime;);print_r($val2);现在删除一个数据，使用delte接口，参数就是一个key，然后就能够把Memcache服务器这个key的数据删除，最后输出的时候没有结果$mem-&gt;delete(&lsquo;key1&prime;);$val = $mem-&gt;get(&lsquo;key1&prime;);echo "Get key1 value: " . $val . "&lt;br&gt;";最后我们把所有的保存在Memcache服务器上的数据都清除，会发现数据都没有了，最后输出key2的数据为空，最后关闭连接$mem-&gt;flush();$val2 = $mem-&gt;get(&lsquo;key2&prime;);echo "Get key2 value: ";print_r($val2);echo "&lt;br&gt;";Memcache的使用使用Memcache的网站一般流量都是比较大的，为了缓解数据库的压力，让Memcache作为一个缓存区域，把部分信息保存在内存中，在前端能够迅速的进行存取。那么一般的焦点就是集中在如何分担数据库压力和进行分布式，毕竟单台Memcache的内存容量的有限的。我这里简单提出我的个人看法，未经实践，权当参考。分布式应用Memcache本来支持分布式，我们客户端稍加改造，更好的支持。我们的key可以适当进行有规律的封装，比如以user为主的网站来说，每个用户都有User ID，那么可以按照固定的ID来进行提取和存取，比如1开头的用户保存在第一台Memcache服务器上，以2开头的用户的数据保存在第二胎Mecache服务器上，存取数据都先按照User ID来进行相应的转换和存取。但是这个有缺点，就是需要对User ID进行判断，如果业务不一致，或者其他类型的应用，可能不是那么合适，那么可以根据自己的实际业务来进行考虑，或者去想更合适的方法。减少数据库压力这个算是比较重要的，所有的数据基本上都是保存在数据库当中的，每次频繁的存取数据库，导致数据库性能极具下降，无法同时服务更多的用户，比如MySQL，特别频繁的锁表，那么让Memcache来分担数据库的压力吧。我们需要一种改动比较小，并且能够不会大规模改变前端的方式来进行改变目前的架构。我考虑的一种简单方法：后端的数据库操作模块，把所有的Select操作提取出来（update/delete/insert不管），然后把对应的SQL进行相应的hash算法计算得出一个hash数据key（比如MD5或者SHA），然后把这个key去Memcache中查找数据，如果这个数据不存在，说明还没写入到缓存中，那么从数据库把数据提取出来，一个是数组类格式，然后把数据在set到Memcache中，key就是这个SQL的hash值，然后相应的设置一个失效时间，比如一个小时，那么一个小时中的数据都是从缓存中提取的，有效减少数据库的压力。缺点是数据不实时，当数据做了修改以后，无法实时到前端显示，并且还有可能对内存占用比较大，毕竟每次select出来的数据数量可能比较巨大，这个是需要考虑的因素。Memcache的安全我们上面的Memcache服务器端都是直接通过客户端连接后直接操作，没有任何的验证过程，这样如果服务器是直接暴露在互联网上的话是比较危险，轻则数据泄露被其他无关人员查看，重则服务器被入侵，因为Mecache是以root权限运行的，况且里面可能存在一些我们未知的bug或者是缓冲区溢出的情况，这些都是我们未知的，所以危险性是可以预见的。为了安全起见，我做两点建议，能够稍微的防止黑客的入侵或者数据的泄露。内网访问最好把两台服务器之间的访问是内网形态的，一般是Web服务器跟Memcache服务器之间。普遍的服务器都是有两块网卡，一块指向互联网，一块指向内网，那么就让Web服务器通过内网的网卡来访问Memcache服务器，我们Memcache的服务器上启动的时候就监听内网的IP地址和端口，内网间的访问能够有效阻止其他非法的访问。# memcached -d -m 1024 -u root -l 192.168.0.200 -p 11211 -c 1024 -P /tmp/memcached.pidMemcache服务器端设置监听通过内网的192.168.0.200的ip的11211端口，占用1024MB内存，并且允许最大1024个并发连接设置防火墙防火墙是简单有效的方式，如果却是两台服务器都是挂在网的，并且需要通过外网IP来访问Memcache的话，那么可以考虑使用防火墙或者代理程序来过滤非法访问。一般我们在Linux下可以使用iptables或者FreeBSD下的ipfw来指定一些规则防止一些非法的访问，比如我们可以设置只允许我们的Web服务器来访问我们Memcache服务器，同时阻止其他的访问。# iptables -F# iptables -P INPUT DROP# iptables -A INPUT -p tcp -s 192.168.0.2 &ndash;dport 11211 -j ACCEPT# iptables -A INPUT -p udp -s 192.168.0.2 &ndash;dport 11211 -j ACCEPT上面的iptables规则就是只允许192.168.0.2这台Web服务器对Memcache服务器的访问，能够有效的阻止一些非法访问，相应的也可以增加一些其他的规则来加强安全性，这个可以根据自己的需要来做</p><p>[4]</p><p>[5]</p><p>[6]</p><p>[7]</p><p>[8]</p><p>[9]</p><p>[10]</p><p>[11]</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>