---
layout: post
title: Android拓展系列(6)--CM9源码下载和编译
---

<p>公司最近也开始基于android4.0 ICS修改框架了，公司的手机暂时不适合拿回家测试，也没有kernel的权限。从个人的角度看，我手上现在有两部手机，一部是Htc G9 Aria，一部是Samsung I9100 Galaxys2,Cyanogenmod的开源代码都提供了对这些手机的驱动支持，并且能方便的编译打包，并安装到手机。上一篇文章是android2.3的编译，已经过时，而且现在ubuntu已经升级到12.04，等等之类的，使我觉得非常有必要重新写一篇新的博客来展示最新的android怎么在最新的ubuntu上编译。基于以上几点，下面我将基于galaxys2来演示如何编译cm9的源码并打包zip安装到手机。下面是我的参考文章：http://source.android.com/source/initializing.htmlhttp://forum.xda-developers.com/showthread.php?t=1552090https://github.com/CyanogenMod/android这些链接或多或少会有一些问题，从这些这些东西我整理出最简单最有效的一条编译之路，也许会很上面这些文章很多步骤和说法上不一致。</p><p>1.ubuntu12.04的选择我第一次用x64的系统，发现配置环境的时候，会有很多种错误，后来我用32位的系统，安装这些必备的软件则一点都没有出错，所以在这里，如果用12.04系统编译cyanogenmod ics源码的话，我以个人经验推荐使用32位系统。</p><p>2.内存和cpu因为有些朋友在虚拟机上安装ubuntu，所以内存分配可能会容易偏小，建议尽量偏大，我1G内存的时候，编译中出现过错误，重启设置2G的内存就没问题。cpu太弱的话，编译的过程中进程也容易被kill掉，我出现过一次，重启后ok。所以cpu的水平要注意一下。</p><p>3.java的选择无论是android官方文档还是上面的那篇文章，java的安装都会找不到，他们的软件源有问题。需要手动安装。但是android ics的编译，官方文章中指出支持openjdk-6-jdk,所以可以直接安装openjdk6即可。注意:这里我要说明一下,CM9的编译脚本相对于官方源码的编译脚本忽略了或者说处理了一些可能出现的错误的地方，比如说这里java版本的检测，如果是open jdk的话，官方就编译不过，其实是一样的，只需要修改一下脚本(build/core/main.mk)，找到检测java版本的地方：</p><pre class="brush:Perl;gutter:true;"># Check for the correct version of javajava_version := $(shell java -version 2&gt;&amp;1 | head -n 1 | grep '^java .*[ "]1\.6[\. "$$]')ifneq ($(shell java -version 2&gt;&amp;1 | grep -i openjdk),)java_version :=endififeq ($(strip $(java_version)),)$(info ************************************************************)$(info You are attempting to build with the incorrect version)$(info of java.)$(info $(space))$(info Your version is: $(shell java -version 2&gt;&amp;1 | head -n 1).)$(info The correct version is: Java SE 1.6.)$(info $(space))$(info Please follow the machine setup instructions at)$(info $(space)$(space)$(space)$(space)http://source.android.com/source/download.html)$(info ************************************************************)#$(error stop) //如果确定已经安装正确的jdk的话，这句去掉，让编译继续endif</pre>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>