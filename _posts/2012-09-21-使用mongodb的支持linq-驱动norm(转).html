---
layout: post
title: 使用MongoDB的支持Linq 驱动NoRM(转)
---

<p>MongoDB的驱动有好几个，分布式文件存储的数据库开源项目MongoDB里使用的是github.com/samus/mongodb-csharp，monogodb-csharp不是强类型，使用起来不方便。转向使用支持强类型访问MongoDB的NoRM C# driver。NoRM 驱动和MongoDB-CSharp的一个区别的地方就是NoRM使用强类型的类操作MongoDB-CSharp的Document类。 <p>使用NoRM很简单，引用NoRM.dll就可以了，下面的例子是一个控制台程序： <p> <p>模型类，代表保存到数据库的数据 <p>view source <p>print? <p><code>01</code><code>using</code> <code>System; </code> <p><code>02</code><code>using</code> <code>System.Collections.Generic; </code> <p><code>03</code><code>using</code> <code>System.Linq; </code> <p><code>04</code><code>using</code> <code>System.Text; </code> <p><code>05</code><code>using</code> <code>Norm; </code> <p><code>06</code><code></code> <p><code>07</code><code>namespace</code> <code>FirstMongoDb </code> <p><code>08</code><code>{ </code> <p><code>09</code><code>public</code> <code>class</code> <code>Customer: IHaveIdentifier </code> <p><code>10</code><code>{ </code> <p><code>11</code><code>public</code> <code>ObjectId _id { </code><code>get</code><code>; </code><code>set</code><code>; } </code> <p><code>12</code><code>public</code> <code>string</code> <code>Name { </code><code>get</code><code>; </code><code>set</code><code>; } </code> <p><code>13</code><code>public</code> <code>DateTime LastOrderUtc { </code><code>get</code><code>; </code><code>set</code><code>; } </code> <p><code>14</code><code>public</code> <code>List&lt;</code><code>string</code><code>&gt; OrderedItems { </code><code>get</code><code>; </code><code>set</code><code>; } </code> <p><code>15</code><code></code> <p><code>16</code><code>public</code> <code>Customer() </code> <p><code>17</code><code>{ </code> <p><code>18</code><code>OrderedItems = </code><code>new</code> <code>List&lt;</code><code>string</code><code>&gt;(); </code> <p><code>19</code><code>} </code> <p><code>20</code><code>} </code> <p><code>21</code><code>}</code> <p>这个足够简单了，下面我们连到数据库 <p>view source <p>print? <p><code>01</code><code>public</code> <code>class</code> <code>MongoDbDataContext : IDisposable </code> <p><code>02</code><code>{ </code> <p><code>03</code><code>private</code> <code>readonly</code> <code>MongoQueryProvider provider; </code> <p><code>04</code><code></code> <p><code>05</code><code>public</code> <code>MongoQueryProvider Provider </code> <p><code>06</code><code>{ </code> <p><code>07</code><code>get</code> <code>{ </code><code>return</code> <code>provider; } </code> <p><code>08</code><code>} </code> <p><code>09</code><code></code> <p><code>10</code><code>public</code> <code>static</code> <code>string</code> <code>DatabaseName { </code><code>get</code><code>; </code><code>set</code><code>; } </code> <p><code>11</code><code></code> <p><code>12</code><code>public</code> <code>MongoDbDataContext() </code> <p><code>13</code><code>{ </code> <p><code>14</code><code>if</code> <code>( </code><code>string</code><code>.IsNullOrEmpty( DatabaseName ) ) </code> <p><code>15</code><code>{ </code> <p><code>16</code><code>throw</code> <code>new</code> <code>InvalidOperationException( </code><code>"You must set the static DatabaseName property."</code> <code>); </code> <p><code>17</code><code>} </code> <p><code>18</code><code>provider = </code><code>new</code> <code>MongoQueryProvider( </code> <p><code>19</code><code>new</code> <code>Mongo( DatabaseName, </code><code>"127.0.0.1"</code><code>, </code><code>"27017"</code><code>, </code><code>null</code> <code>) ); </code> <p><code>20</code><code>}</code> <p>使用NoRM去冬连接到数据需要提供一个数据库名，服务器地址和端口，参看上述红色代码。 <p>插入一个对象到数据库 <p>view source <p>print? <p><code>01</code><code>private</code> <code>static</code> <code>void</code> <code>Insert() </code> <p><code>02</code><code>{ </code> <p><code>03</code><code></code> <p><code>04</code><code></code><code>Customer c = </code><code>new</code> <code>Customer(); </code> <p><code>05</code><code>c.Name = </code><code>"Jake"</code><code>; </code> <p><code>06</code><code>c.LastOrderUtc = DateTime.UtcNow; </code> <p><code>07</code><code>c.OrderedItems.Add(</code><code>"frappa"</code><code>); </code> <p><code>08</code><code>c.OrderedItems.Add( </code><code>"beer"</code> <code>); </code> <p><code>09</code><code>c.OrderedItems.Add( </code><code>"redbull!"</code> <code>); </code> <p><code>10</code><code>c.OrderedItems.Add( </code><code>"wings"</code> <code>); </code> <p><code>11</code><code></code> <p><code>12</code><code>using</code> <code>( MongoDbDataContext ctx = </code><code>new</code> <code>MongoDbDataContext() ) </code> <p><code>13</code><code>{ </code> <p><code>14</code><code>ctx.Add(c); </code> <p><code>15</code><code>} </code> <p><code>16</code><code>}</code> <p>使用LINQ查询数据库 <p>view source <p>print? <p><code>01</code><code>using</code> <code>( MongoDbDataContext ctx = </code><code>new</code> <code>MongoDbDataContext() ) </code> <p><code>02</code><code>{ </code> <p><code>03</code><code>var query = </code> <p><code>04</code><code>from c </code><code>in</code> <code>ctx.Customers </code> <p><code>05</code><code>where c.Name == </code><code>"Michael"</code> <p><code>06</code><code>orderby c.LastOrderUtc descending </code> <p><code>07</code><code>select c; </code> <p><code>08</code><code></code> <p><code>09</code><code>foreach</code> <code>(var customer </code><code>in</code> <code>query) </code> <p><code>10</code><code>{ </code> <p><code>11</code><code>Console.WriteLine(</code><code>"{0} bought {1}"</code><code>, </code> <p><code>12</code><code>customer.Name, </code> <p><code>13</code><code>customer.OrderedItems.FirstOrDefault() </code> <p><code>14</code><code>); </code> <p><code>15</code><code>} </code> <p><code>16</code><code>}</code> <p>参考：Using MongoDB with the NoRM driver <p>文章来源 cnblogs <p>标签： NORM MongoDB LINQ <p>补充话题说明&#187;</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>