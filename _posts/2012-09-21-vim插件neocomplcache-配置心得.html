---
layout: post
title: Vim插件neocomplcache 配置心得
---

<p>对于Vimist 来说，neocomplcache 这个插件让人又爱又恨。主要是功能强大，配置复杂，而且喜欢跟各种插件冲突。</p><p>我也是被他折腾了个半死。期间搜索无数次，却找不到详细的配置。在不断摸索和阅读帮助文档以及源代码后，终于有了一点心得。而且把这个插件配置的比较爽了，配合SNIPMATE使用后基本类似VISUAL STUDIO下的VISUAL ASSIST X的感觉。</p><p>neocomplcache 其实不用配 SNIPMATE 也基本能用，但是SNIPMATE的snippets比较全，而且网上有加强版本的snippets，snippets的数目要大大超过neocomplcache 。而可悲的是neocomplcache 不能直接调用 SNIPMATE 的 snippets。所以没法去掉SNIPMATE。</p><p>但是SNIPMATE把关键的TAB键给占用了（用TAB激活它的snippets，有方法可以改它的源代码来实现）。neocomplcache 选择候选字时就没法通过TAB来很爽的选择了，不过经过配置后我还是有几种方法可以用的比较爽：</p><p>1、启用快速匹配：</p><p>let g:neocomplcache_enable_quick_match = 1 &ldquo;For input-saving, this variable controls whether you can choose a candidate with a alphabet or number displayed beside a candidate after '-'. When you input 'ho-a', neocomplcache will select candidate 'a'.</p><p>打开这个开关后，每次补全菜单弹出时，可以再按一个&rdquo;-&ldquo;键，这是补全菜单中的每个候选词会被标上一个字母，只要再输入对应字母就可以马上完成选择。</p><p>2、CTRL-N,CTRL-P：</p><p>这两个组合键可以替代TAB的功能，向上或者向下选择你的候选字。</p><p>3、使用SPACE: inoremap &lt;expr&gt;&lt;space&gt; pumvisible() ? neocomplcache#close_popup() . "\&lt;SPACE&gt;" : "\&lt;SPACE&gt;"</p><p>用SPACE自动旋转当前的候选字，并附加一个空格。这个才是真正无阻碍的输入方式。在SPACE面前什么&lt;TAB&gt;,&lt;ENTER&gt;都是浮云。neocomplcache 的作者居然都没想到这点 。给出的推荐配置中还在纠结于 &lt;TAB&gt;,&lt;ENTER&gt;。这也是 VISUAL ASSIST X推荐的方式。</p><p>当然研究这么久 neocomplcache 肯定不止这一点收获。还有几天TIPS：</p><p>1、neocomplcache 可以根据文件类型选用 dict 词典，这个是EDITPLUS的首创吧，可以直接拷贝EDITPLUS的语法文件过来了，稍微整理一下就可以指定给neocomplcache去用：</p><p>" Define dictionary. let g:neocomplcache_dictionary_filetype_lists = {  \ 'default' : '',  \ 'vimshell' : $HOME.'/.vimshell_hist',  \ 'scheme' : $HOME.'/.gosh_completions',  \ 'css' : $VIMFILES.'/dict/css.dic',  \ 'php' : $VIMFILES.'/dict/php.dic',  \ 'javascript' : $VIMFILES.'/dict/javascript.dic'  \ }</p><p>2、neocomplcache 默认的回车定义会跟 'auto-pairs' ，'endwise' 之类的通过回车补全的插件相冲突。这个BUG废掉我一个晚上。不过我也从中找出一个寻找冲突插件的配置方法。就是用 pathogen 的禁用功能： call add(g:pathogen_disabled, 目录名) 。先将bundle下的所有插件都用这个函数禁用掉。然后再分批在前面加&rdquo;注释掉禁用--也就是打开插件。这样多测试几次，只用几分钟就能找到冲突的插件了。</p><p>call add(g:pathogen_disabled, 'auto-pairs') " conflict with neocomplcache call add(g:pathogen_disabled, 'endwise') " conflict with neocomplcache</p><p>关于 pathogen ，这年头高手管理VIM插件都是用 pathogen 和 git 了。如果你还是将下载的插件混杂在一起，那就该考虑更新一下了。</p><p>而GIT对于维护一个时刻保持更新的 网络版的 VIM 配置库是必不可少的。这方面需要严重参考这篇文章：</p><p>http://blog.wu-boy.com/2011/09/introduction-to-git-submodule/</p><p>也就是说，你基本只用维护你的VIMRC文件，以及插件列表，而将具体的插件，通过PATHOGEN配置到BUNDLE下的各个目录，然后通过GIT SUBMODULE指向各插件的原文件库，这样你就拥有了一个永远最新的VIM 发行版。</p><p>有人说EMACS是一个伪装成编辑器的操作系统，VIM又何尝不是。。。启动引导，加载模块，桌面管理，这些概念在这些编辑器中都体现的淋漓尽致。</p><p>关于键冲突的问题，这里有讨论：https://github.com/sjbach/lusty/issues/20</p><p>https://github.com/ervandew/supertab/issues/10</p><p>3、neocomplcache 配置文件中用到的一些函数说明：</p><p>pumvisible（） 这个: 如果弹出菜单可见，返回非零，不然返回零。</p><p>neocomplcache#undo_completion 这个看名字就知道，做一次undo，取消补全。</p><p>neocomplcache#close_popup() 这个是用候选字补全后关闭弹出框</p><p>neocomplcache#cancel_popup() 这个是什么也不做，直接关闭弹出框</p><p>neocomplcache#smart_close_popup() 这个直接看函数定义吧。号称是智能的，但是我设置了半天 g:neocomplcache_enable_auto_select 还是无效，索性直接换成 neocomplcache#close_popup() 了。</p><pre>  1: function! neocomplcache#smart_close_popup()</pre><pre>  2:   return g:neocomplcache_enable_auto_select ? neocomplcache#cancel_popup() : neocomplcache#close_popup()</pre><pre>  3: endfunction</pre><p>最后是我的配置文件，由于配置文件太大，我是直接存了一个 neocomplcache.conf的文件，然后在vimrc中去调用它：</p><p>" --- NeoComplcache It's such a big config file that I split into a single file. source $VIM/vimfiles/neocomplcache.conf</p><pre></pre><pre>  1: " Disable AutoComplPop.</pre><pre>  2: let g:acp_enableAtStartup = 0</pre><pre>  3: " Use neocomplcache.</pre><pre>  4: let g:neocomplcache_enable_at_startup = 1</pre><pre>  5: " Use smartcase.</pre><pre>  6: let g:neocomplcache_enable_smart_case = 1</pre><pre>  7: " Use camel case completion.</pre><pre>  8: let g:neocomplcache_enable_camel_case_completion = 1</pre><pre>  9: " Use underbar completion.</pre><pre> 10: let g:neocomplcache_enable_underbar_completion = 1</pre><pre> 11: " Set minimum syntax keyword length.</pre><pre> 12: let g:neocomplcache_min_syntax_length = 3</pre><pre> 13: let g:neocomplcache_lock_buffer_name_pattern = '\*ku\*'</pre><pre> 14: </pre><pre> 15: " AutoComplPop like behavior.</pre><pre> 16: let g:neocomplcache_enable_auto_select = 0</pre><pre> 17: </pre><pre> 18: " When you input 'ho-a',neocomplcache will select candidate 'a'.</pre><pre> 19: let g:neocomplcache_enable_quick_match = 1</pre><pre> 20: </pre><pre> 21: " Define dictionary.</pre><pre> 22: let g:neocomplcache_dictionary_filetype_lists = {</pre><pre> 23:     \ 'default' : '',</pre><pre> 24:     \ 'vimshell' : $HOME.'/.vimshell_hist',</pre><pre> 25:     \ 'scheme' : $HOME.'/.gosh_completions',</pre><pre> 26:     \ 'css' : $VIMFILES.'/dict/css.dic',</pre><pre> 27:     \ 'php' : $VIMFILES.'/dict/php.dic',</pre><pre> 28:     \ 'javascript' : $VIMFILES.'/dict/javascript.dic'</pre><pre> 29:     \ }</pre><pre> 30: </pre><pre> 31: let g:neocomplcache_snippets_dir=$VIMFILES."/snippets"</pre><pre> 32: inoremap &lt;expr&gt;&lt;S-TAB&gt;  pumvisible() ? "\&lt;C-p&gt;" : "\&lt;TAB&gt;"</pre><pre> 33: inoremap &lt;expr&gt;&lt;C-TAB&gt;  pumvisible() ? "\&lt;C-p&gt;" : "\&lt;TAB&gt;"</pre><pre> 34: </pre><pre> 35: </pre><pre> 36: " Define keyword.</pre><pre> 37: if !exists('g:neocomplcache_keyword_patterns')</pre><pre> 38:   let g:neocomplcache_keyword_patterns = {}</pre><pre> 39: endif</pre><pre> 40: let g:neocomplcache_keyword_patterns['default'] = '\h\w*'</pre><pre> 41: </pre><pre> 42: " Plugin key-mappings.</pre><pre> 43: imap &lt;C-k&gt;     &lt;Plug&gt;(neocomplcache_snippets_expand)</pre><pre> 44: smap &lt;C-k&gt;     &lt;Plug&gt;(neocomplcache_snippets_expand)</pre><pre> 45: inoremap &lt;expr&gt;&lt;C-g&gt;     neocomplcache#undo_completion()</pre><pre> 46: inoremap &lt;expr&gt;&lt;C-z&gt;     neocomplcache#undo_completion()</pre><pre> 47: inoremap &lt;expr&gt;&lt;C-l&gt;     neocomplcache#complete_common_string()</pre><pre> 48: </pre><pre> 49: " SuperTab like snippets behavior.</pre><pre> 50: "imap &lt;expr&gt;&lt;TAB&gt; neocomplcache#sources#snippets_complete#expandable() ? "\&lt;Plug&gt;(neocomplcache_snippets_expand)" : pumvisible() ? "\&lt;C-n&gt;" : "\&lt;TAB&gt;"</pre><pre> 51: </pre><pre> 52: " Recommended key-mappings.</pre><pre> 53: " &lt;CR&gt;: close popup and save indent.</pre><pre> 54: " inoremap &lt;expr&gt;&lt;CR&gt;  neocomplcache#close_popup() . "\&lt;CR&gt;"</pre><pre> 55: inoremap &lt;expr&gt;&lt;CR&gt; pumvisible() ? neocomplcache#close_popup() : "\&lt;CR&gt;"</pre><pre> 56: " &lt;TAB&gt;: completion. THIS HAS NO USE WHEN WITH SNIPMATE</pre><pre> 57: " inoremap &lt;expr&gt;&lt;TAB&gt;  pumvisible() ? "\&lt;C-n&gt;" : "\&lt;TAB&gt;"</pre><pre> 58: " &lt;SPACE&gt;: completion.</pre><pre> 59: inoremap &lt;expr&gt;&lt;space&gt;  pumvisible() ? neocomplcache#close_popup() . "\&lt;SPACE&gt;" : "\&lt;SPACE&gt;"</pre><pre> 60: </pre><pre> 61: </pre><pre> 62: " &lt;C-h&gt;, &lt;BS&gt;: close popup and delete backword char.</pre><pre> 63: inoremap &lt;expr&gt;&lt;C-h&gt; neocomplcache#close_popup()."\&lt;C-h&gt;"</pre><pre> 64: inoremap &lt;expr&gt;&lt;BS&gt; neocomplcache#close_popup()."\&lt;C-h&gt;"</pre><pre> 65: </pre><pre> 66: inoremap &lt;expr&gt;&lt;C-y&gt;  neocomplcache#close_popup()</pre><pre> 67: inoremap &lt;expr&gt;&lt;C-e&gt;  neocomplcache#cancel_popup()</pre><pre> 68: </pre><pre> 69: " Shell like behavior(not recommended).</pre><pre> 70: "set completeopt+=longest</pre><pre> 71: "let g:neocomplcache_enable_auto_select = 1</pre><pre> 72: "let g:neocomplcache_disable_auto_complete = 1</pre><pre> 73: "inoremap &lt;expr&gt;&lt;TAB&gt;  pumvisible() ? "\&lt;Down&gt;" : "\&lt;TAB&gt;"</pre><pre> 74: "inoremap &lt;expr&gt;&lt;CR&gt;  neocomplcache#close_popup() . "\&lt;CR&gt;"</pre><pre> 75: </pre><pre> 76: " Enable omni completion.</pre><pre> 77: autocmd FileType css setlocal omnifunc=csscomplete#CompleteCSS</pre><pre> 78: autocmd FileType html,markdown setlocal omnifunc=htmlcomplete#CompleteTags</pre><pre> 79: autocmd FileType javascript setlocal omnifunc=javascriptcomplete#CompleteJS</pre><pre> 80: autocmd FileType python setlocal omnifunc=pythoncomplete#Complete</pre><pre> 81: autocmd FileType xml setlocal omnifunc=xmlcomplete#CompleteTags</pre><pre> 82: autocmd FileType ruby setlocal omnifunc=rubycomplete#Complete</pre><pre> 83: </pre><pre> 84: " Enable heavy omni completion.</pre><pre> 85: if !exists('g:neocomplcache_omni_patterns')</pre><pre> 86:   let g:neocomplcache_omni_patterns = {}</pre><pre> 87: endif</pre><pre> 88: let g:neocomplcache_omni_patterns.ruby = '[^. *\t]\.\w*\|\h\w*::'</pre><pre> 89: let g:neocomplcache_omni_patterns.php = '[^. \t]-&gt;\h\w*\|\h\w*::'</pre><pre> 90: let g:neocomplcache_omni_patterns.c = '\%(\.\|-&gt;\)\h\w*'</pre><pre> 91: let g:neocomplcache_omni_patterns.cpp = '\h\w*\%(\.\|-&gt;\)\h\w*\|\h\w*::'</pre>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>