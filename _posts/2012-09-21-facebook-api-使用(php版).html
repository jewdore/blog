---
layout: post
title: Facebook Api 使用(PHP版)
---

<p>如果想通过Facebook登录到你的网站,Facebook站外API可以实现你想要的,如下介绍实际使用.</p><p>(我目前没在网上找到中文的更详细的介绍了,呵呵.)</p><p>(提示:Facebook不支持取得朋友的邮件地址,如果需求是这个,别在浪费功夫了)</p><p>注册Facebook Key http://www.facebook.com/developers/apps.php注册后可以得到</p><p>App ID,API Key,App Secret (如果你想测试,必须要一个域名,申请的时候填上)</p><p>到https://github.com/facebook/php-sdk/下载PHP开发包</p><p>进入examples/页面,里面有个示例文件,</p><p>$facebook = new Facebook(array( 'appId' =&gt; '',//你的App ID 'secret' =&gt; '',//你的App Secret 'cookie' =&gt; true,));</p><p>修改如上</p><p>如果你本地的服务器无法验证FACEBOOK的SSL验证,请修改facebook class 的方法makeRequest</p><p>在curl_init()之后添加:</p><p>$opts[CURLOPT_SSL_VERIFYPEER] = false; $opts[CURLOPT_SSL_VERIFYHOST] = 2; </p><p>上面的API支持FACEBOOK新旧两种格式,</p><p>通过调用api传不同的参数实现</p><p>1.路径型,如:/me </p><p>还有具体的参数可以参考:http://developers.facebook.com/docs/reference/api/页面</p><p>在右边objects下面,每个点击进去之后都有非常多的参数</p><p>2.数组型,如array("method"=&gt;"links.get")</p><p>数组型是为兼容旧的API而保留的,建议用新的.旧的所有功能基本上新的都有,具体参数可以参考:getApiUrl 方法</p><p>如果你使用 /me 你会发现你取不到自己的邮箱地址,是因为你没权限,在http://developers.facebook.com/docs/reference/api/user/</p><p>你会发现有很多东西是要得到用户的授权才可以访问的,以下是具体的授权方式:</p><p>https://graph.facebook.com/oauth/authorize?client_id=171908639493418&amp;redirect_uri=you url address&amp;scope=read_mailbox,email</p><p>你也可以自己来往facebook里添加生成上述地址的方法,这里不介绍了</p><p>可以得到授权,你就可以往facebook推送消息了</p><p>$dat=array("picture"=&gt;"image","subject"=&gt;"你好啊~","message"=&gt;"呵呵,测试FACEBOOKAPI~,这个是测试信息.联系Q:97148830",);</p><p>$f = $facebook-&gt;api('/me/friends');foreach($f['data'] as $v){$f = $facebook-&gt;api('/'.$v['id'].'/feed',"POST",$dat);//$f是返回你发送的消息的ID,消息只能发送到公开的版面,比如消息墙}</p><p>通过不同的$dat参数来实现不同的消息,具体你就参考上面的API参数解释的地址吧</p><p>还有一个问题,加入一个用户登录了你的网站后立即跑到facebook去把他刚才的授权给取消掉,你去取他的信息的时候就出错误了,</p><p>facebook也为这个情况提供了一个解决办法,请参考:http://developers.facebook.com/docs/reference/api/subscription/</p><p>就是让你的应用程序就订阅用户的状态,但用户使用了你的应用程序之后对你的在facebook上的应用进行有关操作的时候,facebook会发消息提示你</p><p>想使用这个功能,你得先到你的网站建立一个回调验证程序,FACEBOOK也为你提供了,可以在http://github.com/facebook/real-time/blob/master/samples/下载得到</p><p>把里面的callback.php放到你的站点目录,这个文件用于验证应用程序是你的外还用于得到用户的活动消息,</p><p>下面是如何添加订阅,查询订阅,删除订阅的代码,(更改就是发送添加订阅,存在的话会覆盖掉以前的)</p><p>$acc=file_get_contents("https://graph.facebook.com/oauth/access_token?client_id=you app id&amp;client_secret=you app secret&amp;grant_type=client_credentials"); $t=explode("=",$acc); $dat=array( "object"=&gt;"user","fields"=&gt;"feed,friends,activities,interests,music,books,movies,television,likes,checkins",//就支持这些"callback_url"=&gt;"",//刚刚那个callback.php"verify_token"=&gt;"abc",//你的callback.php里的那个token,自己看下或自己修改"access_token"=&gt;$t[1]);$f = $facebook-&gt;api('/appid/subscriptions',"POST",$dat);//添加print_r($f);//啥也没返回 $dat=array( "access_token"=&gt;$t[1]);$f = $facebook-&gt;api('/appid/subscriptions',"GET",$dat);//查询print_r($f);//很多关于你订阅的东东$param = array('access_token' =&gt; $t[1]);$subs = $facebook-&gt;api('/appid/subscriptions', 'DELETE', $param); //干掉了</p><p>添加后如果别人移除了他使用你的应用程序,会得到一个消息,大约如下:</p>Array( [fb_sig_uninstall] =&gt; 1//YOU APP UNINSTALL [fb_sig_locale] =&gt; en_US [fb_sig_in_new_facebook] =&gt; 1 [fb_sig_time] =&gt; 1293444384.8939 [fb_sig_added] =&gt; 0 [fb_sig_user] =&gt; 100001008942959 [fb_sig_country] =&gt; us [fb_sig_api_key] =&gt; appkey [fb_sig_app_id] =&gt; appid [fb_sig] =&gt; 383d629e8eeac39022adbc1d158f6065)

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>