---
layout: post
title: 【Based Android】PreferenceActivity设置菜单介绍（续）
---

<p> 在上一篇文章中http://www.cnblogs.com/octobershiner/archive/2011/11/07/2239621.html ，和大家分享了一下android中实现设置的一个非常重要的类SharedPreference，其实android为实现程序的设置界面提佛提提供了更为简介的方案，那就是今天要介绍的PreferenceActivity，我们看到很多的android程序设置界面都是类似的，其中大部分都采用了这样的一种方式。</p><p> android为了方便开发，提供了一个特殊的activity类，PreferenceActivity，用来快速的实现一个设置界面，从名字就可以看出是继承自Activity类（实际上是ListActivity），因而生命周期是一样的。</p><p> 那么常见的设置菜单有两种，一是只有一个header的（左图），另一种是在3.0发布后加入的，多header的设置菜单（右图）。那么要实现多header的设置菜单，需要引用新的类PreferenceFragment,我们今天只讨论实现一个header的（比较常用）。</p><p>  </p><p> 那么如何用PreferenceActivity呢？</p><p> 首先我们需要一个配置文件，类似于main.xml，就是我们需要一个资源布局文件。</p><hr /><p> 在xml文件夹下创建一个conf.xml文件用于保存我们的布局</p><p> 目前android只提供了几种可选的组建，包括</p><p> PreferenceScreen 表示一个新的设置窗口，也是我们的布局的根标签。</p><p> CheckBoxPreference 表示勾选的选项</p><p> ListPreference 表示一个选项列表</p><p> EditTextPreference 表示一个文本输入框</p><p> PreferenceCategory 用于分组 </p><p> RingtonePreference 用于铃声的设置</p><p> 这些都继承自Preference，他们都有的特点就是都有一个key，这个的作用和我们常用的id差不多，一会如果我们要引用这个组建就要通过key来找到他。还有一个共有的属性就是title，他就是每一个设置组建所显示的内容，summary属性显示下面的文本。</p><p> 其中比较特殊的是ListPreference，他需要关联一个数组资源，如上面代码中的@array/user_type</p><p> 更多的组建，大家可以产看sdk文档，很多还没有提供在xml直接使用。</p><p> 那么如何将xml和activity关联呢？</p><p> 我们需要在onCreate方法里面调用</p><p> </p><p> 这样程序启动就会自动加载这个视图文件，效果如下</p><p> </p><p> 这个时候如果我们修改了配置的选项，会默认的保存在data/data目录下，如果我们想获取这些值，就可以参照上一篇文章中说讲的内容了。我们现在看一下这些数据存在哪里，在终端中打开adb shell ，我们切到data/data目录下，进入到我们的包中，可以看到shared_prefs文件夹，里面就有我们的com.yui_preferences.xml文件，打开就可以看到已经写入的一些数据了。</p><p> </p><p> PreferenceActiviy实现事件监听</p><hr /><p> preferenceAcitivity提供了连个事件监听器</p><p> OnPreferenceChangeListener用来监听某个属性是否发生了变化。它只有一个方法：</p><h4 class="jd-details-title"> public abstract boolean  onPreferenceChange (Preference preference, Object newValue)<p> 第一个参数是 发生变化的组件，第二个参数是新的数值</p><p> 如果返回true的话就将变化写入文件，返回false不发生改变</p><p> 第二个监听器更为灵活 </p><p> OnPreferenceClickListener 用来监听某个选项是否被点击，它也只有一个方法</p><p> public abstract boolean  onPreferenceClick (Preference preference)   返回true表示处理事件</p><p> 接下来就是要给我们的组建注册监听器：</p><p> </p><p> </p><p>为了方便演示，我们使用了Toast实时的显示信息，这个非常简单，就不多介绍了，那么在处理事件的时候，我们只需要判断一下是哪个组件需要响应就好了</p><p> 最后看一下程序运行的结果吧,当我们改变设置的时候就可以监听到了，结合上一篇文章就可以完成一个完整的设置---读写的模块了。</p><p>     </p><blockquote><p> 程序的完整源代码下载：https://github.com/octobershiner/diordna  PreferenceDemo</p></blockquote>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>