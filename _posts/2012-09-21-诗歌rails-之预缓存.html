---
layout: post
title: 诗歌rails 之预缓存
---

<p>http://github.com/defunkt/resque#readme</p><!--Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/-->requireFile.dirname(__FILE__)+'/test_helper'context"Resque"dosetupdoResque.redis.flush_allResque.push(:people,{'name'=&gt;'chris'})Resque.push(:people,{'name'=&gt;'bob'})Resque.push(:people,{'name'=&gt;'mark'})endtest"canputjobsonaqueue"doassertResque::Job.create(:jobs,'SomeJob',20,'/tmp')assertResque::Job.create(:jobs,'SomeJob',20,'/tmp')endtest"cangrabjobsoffaqueue"doResque::Job.create(:jobs,'some-job',20,'/tmp')job=Resque.reserve(:jobs)assert_kind_ofResque::Job,jobassert_equalSomeJob,job.payload_classassert_equal20,job.args[0]assert_equal'/tmp',job.args[1]endtest"canputjobsonaqueuebywayofanivar"doassert_equal0,Resque.size(:ivar)assertResque.enqueue(SomeIvarJob,20,'/tmp')assertResque.enqueue(SomeIvarJob,20,'/tmp')job=Resque.reserve(:ivar)assert_kind_ofResque::Job,jobassert_equalSomeIvarJob,job.payload_classassert_equal20,job.args[0]assert_equal'/tmp',job.args[1]assertResque.reserve(:ivar)assert_equalnil,Resque.reserve(:ivar)endtest"jobshaveanice#inspect"doassertResque::Job.create(:jobs,'SomeJob',20,'/tmp')job=Resque.reserve(:jobs)assert_equal'(Job{jobs}|SomeJob|[20,"/tmp"])',job.inspectendtest"canputjobsonaqueuebywayofamethod"doassert_equal0,Resque.size(:method)assertResque.enqueue(SomeMethodJob,20,'/tmp')assertResque.enqueue(SomeMethodJob,20,'/tmp')job=Resque.reserve(:method)assert_kind_ofResque::Job,jobassert_equalSomeMethodJob,job.payload_classassert_equal20,job.args[0]assert_equal'/tmp',job.args[1]assertResque.reserve(:method)assert_equalnil,Resque.reserve(:method)endtest"needstoinferaqueuewithenqueue"doassert_raisesResque::NoQueueErrordoResque.enqueue(SomeJob,20,'/tmp')endendtest"canputitemsonaqueue"doassertResque.push(:people,{'name'=&gt;'jon'})endtest"canpullitemsoffaqueue"doassert_equal({'name'=&gt;'chris'},Resque.pop(:people))assert_equal({'name'=&gt;'bob'},Resque.pop(:people))assert_equal({'name'=&gt;'mark'},Resque.pop(:people))assert_equalnil,Resque.pop(:people)endtest"knowshowbigaqueueis"doassert_equal3,Resque.size(:people)assert_equal({'name'=&gt;'chris'},Resque.pop(:people))assert_equal2,Resque.size(:people)assert_equal({'name'=&gt;'bob'},Resque.pop(:people))assert_equal({'name'=&gt;'mark'},Resque.pop(:people))assert_equal0,Resque.size(:people)endtest"canpeekataqueue"doassert_equal({'name'=&gt;'chris'},Resque.peek(:people))assert_equal3,Resque.size(:people)endtest"canpeekmultipleitemsonaqueue"doassert_equal({'name'=&gt;'bob'},Resque.peek(:people,1,1))assert_equal([{'name'=&gt;'bob'},{'name'=&gt;'mark'}],Resque.peek(:people,1,2))assert_equal([{'name'=&gt;'chris'},{'name'=&gt;'bob'}],Resque.peek(:people,0,2))assert_equal([{'name'=&gt;'chris'},{'name'=&gt;'bob'},{'name'=&gt;'mark'}],Resque.peek(:people,0,3))assert_equal({'name'=&gt;'mark'},Resque.peek(:people,2,1))assert_equalnil,Resque.peek(:people,3)assert_equal[],Resque.peek(:people,3,2)endtest"knowswhatqueuesitismanaging"doassert_equal%w(people),Resque.queuesResque.push(:cars,{'make'=&gt;'bmw'})assert_equal%w(carspeople),Resque.queuesendtest"queuesarealwaysalist"doResque.redis.flush_allassert_equal[],Resque.queuesendtest"keepstrackofresquekeys"doassert_equal["queue:people","queues"],Resque.keysendtest"badlywantsaclassname,too"doassert_raisesResque::NoClassErrordoResque::Job.create(:jobs,nil)endendtest"keepsstats"doResque::Job.create(:jobs,SomeJob,20,'/tmp')Resque::Job.create(:jobs,BadJob)Resque::Job.create(:jobs,GoodJob)Resque::Job.create(:others,GoodJob)Resque::Job.create(:others,GoodJob)stats=Resque.infoassert_equal8,stats[:pending]@worker=Resque::Worker.new(:jobs)@worker.register_worker2.times{@worker.process}job=@worker.reserve@worker.working_onjobstats=Resque.infoassert_equal1,stats[:working]assert_equal1,stats[:workers]@worker.done_workingstats=Resque.infoassert_equal3,stats[:queues]assert_equal3,stats[:processed]assert_equal1,stats[:failed]assert_equal['localhost:9736'],stats[:servers]endend

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>