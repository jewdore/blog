---
layout: post
title: iPhone开发：iPad的自定义菜单项研究
---

<p>3.2开始可以自定义菜单项了，根据iPadProgrammingGuide小小的研究了一下，</p><p>参考了如下链接http://github.com/billymeltdown/copylabel</p><p>基本思路如下</p><p>custom一个UIView或UIControl，通过touch使它获取焦点即[self becomeFirstResponder]，然后把菜单show出来就可以了</p><p>代码</p><p>#import &lt;UIKit/UIKit.h&gt;</p><p>@interface CustomControl : UIControl {</p><p>CGPoint thePoint;</p><p>}</p><p>- (void)showMenu;</p><p>@end</p><p>#import &quot;CustomControl.h&quot;</p><p>@implementation CustomControl</p><p>-(void)changeColor:(id)sender{</p><p>NSLog(@&quot;changeColor&quot;);</p><p>static int rand = -1;</p><p>if (&#43;&#43;rand==4)</p><p>rand=0;</p><p>UIColor *color = nil;</p><p>switch (rand) {</p><p>case 0:</p><p>color = [UIColor greenColor];</p><p>break;</p><p>case 1:</p><p>color = [UIColor yellowColor];</p><p>break;</p><p>case 2:</p><p>color = [UIColor magentaColor];</p><p>break;</p><p>case 3:</p><p>color = [UIColor purpleColor];</p><p>break;</p><p>default:</p><p>break;</p><p>}</p><p>self.backgroundColor = color;</p><p>}</p><p>-(void)noTouch:(id)sender{</p><p>UIAlertView *alert = [[UIAlertViewalloc] initWithTitle:@&quot;Don't touch me!&quot;</p><p>message:nil</p><p> delegate:nil</p><p> cancelButtonTitle:nil</p><p> otherButtonTitles:@&quot;I Know&quot;,nil];</p><p>[alert show];</p><p>[alert release];</p><p>}</p><p>- (void)showMenu {</p><p>UIMenuController *theMenu = [UIMenuControllersharedMenuController];</p><p>CGRect theFrame = [[self superview]frame];</p><p>CGRect selectionRect = CGRectMake(thePoint.x, theFrame.origin.y -5.0, 0, 0);</p><p>UIMenuItem *menuItem = [[[UIMenuItemalloc] initWithTitle:@&quot;Change Color&quot;</p><p> action:@selector(changeColor:)]autorelease];</p><p>UIMenuItem *menuItem1 = [[[UIMenuItemalloc] initWithTitle:@&quot;Don't touch me!&quot;</p><p>action:@selector(noTouch:)]autorelease];</p><p>//theMenu.arrowDirection = UIMenuControllerArrowLeft;</p><p>theMenu.menuItems = [NSArray arrayWithObjects:menuItem,menuItem1,nil];</p><p>[theMenu setTargetRect:selectionRect inView:self];</p><p>[theMenu setMenuVisible:YESanimated:YES];</p><p>}</p><p>- (void)copy:(id)sender {</p><p>NSLog(@&quot;copy&quot;);</p><p>//override</p><p>}</p><p>- (void)paste:(id)sender{</p><p>NSLog(@&quot;paste&quot;);</p><p>//override</p><p>}</p><p>- (BOOL)canPerformAction:(SEL)action withSender:(id)sender {</p><p>BOOL answer = NO;</p><p>if (action == @selector(copy:)){</p><p>//answer = YES;</p><p>}</p><p>if (action == @selector(paste:)) {</p><p>//answer = YES;</p><p>}</p><p>if (action == @selector(changeColor:)) {</p><p>answer = YES;</p><p>}</p><p>if (action == @selector(noTouch:)) {</p><p>answer = YES;</p><p>}</p><p>return answer;</p><p>}</p><p>- (BOOL)canBecomeFirstResponder {</p><p>  return YES;</p><p>}</p><p>- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {</p><p>if ([selfcanBecomeFirstResponder]) {</p><p>[self becomeFirstResponder];</p><p>UITouch *touch = [touches anyObject];</p><p>thePoint = [touch locationInView:self];</p><p>[self performSelector:@selector(showMenu)withObject:nil afterDelay:0.8f];</p><p>}</p><p>}</p><p>- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event {</p><p>}</p><p>- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event {</p><p>}</p><p>- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event {</p><p>}</p><p>- (void)dealloc {</p><p>[super dealloc];</p><p>}</p><p>@end</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>