---
layout: post
title: 使用jQuery和YQL，以Ajax方式加载外部内容
---

<p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px"></p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">我们来看看怎样使用jQuery，以Ajax方式加载外部（其他域上）的内容。这里的所有代码都可以从GitHub下载，也可以在这个演示页面中获取，因而不用复制粘贴了。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">OK，Ajax通过jQuery是很容易做到的，大多数解决方案就几行代码：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$(document).ready(function(){$('.ajaxtrigger').click(function(){$('#target').load('ajaxcontent.html');});});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">查看这个简单但有点粗陋的Ajax演示就可以看到结果。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">这会将所有带<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">ajaxtrigger</code>类的元素转换成触发器来加载ajaxcontent.html，并在ID为<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">target</code>的元素中显示其内容。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">这样不好，因为多数时候这意味着人们将使用<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">&lt;a href=&quot;#&quot;&gt;click me&lt;/a&gt;</code>这种空链接，但这不是我们现在要讨论的问题。我在撰写一篇更长的文章，其中会提到增强Ajax可用性和可访问性的所有技巧。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">要使其能够重用可以像下面这样：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$(document).ready(function(){$('.ajaxtrigger').click(function(){$('#target').load($(this).attr('href'));return false;});});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">这样，你可以使用<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">&lt;a href=&quot;ajaxcontent.html&quot; class=&quot;ajaxtrigger&quot;&gt;load some content&lt;/a&gt;</code>来加载内容，而所有JavaScript代码都可以重用。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">查看这个可重用Ajax演示就能看到结果。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">我要解决的问题发生在点击演示页面中的第二个链接时：加载外部内容失败，因为Ajax不允许跨域加载内容。这意味着，<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">&lt;a href=&quot;http://icant.co.uk/&quot; class=&quot;ajaxtrigger&quot;&gt;see my portfolio&lt;/a&gt;</code>加载Ajax内容将失败，而且没有提示。尽管你无数遍地点击这个链接，但是什么都不会发生。避免出现这种情况的一个方法，是简单地让浏览器加载该文档，但前提是用户真的想加载外部链接。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">查看这个允许加载外部链接的演示就能看到结果。</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$(document).ready(function(){$('.ajaxtrigger').click(function(){var url = $(this).attr('href');if(url.match('^http')){return true;} else {$('#target').load(url);return false;}});});</code></pre><h3 style="margin-top:1.5em; margin-right:0px; margin-bottom:1em; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:16px; font:inherit; vertical-align:baseline; font-weight:normal; font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">使用PHP代理<p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">如果浏览Web，你会发现大多数的解决方案是PHP（或其他语言）代理脚本。比如，下面是使用cURL的proxy.php代理脚本：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">&lt;?php$url = $_GET['url'];$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$output = curl_exec($ch);curl_close($ch);echo $content;?&gt;</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">然后可以稍作修改使用这个脚本（使用代理）：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$(document).ready(function(){$('.ajaxtrigger').click(function(){var url = $(this).attr('href');if(url.match('^http')){url = 'proxy.php?url=' &#43; url;}$('#target').load(url);return false;});});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">用这样的代理脚本依旧是个很蠢的办法，因为不进行过滤，人们就可以使用这个脚本来加载你服务器上的任何文档，并将其内容显示在自己的页面中（用firebug来重命名链接，就能看到你服务器上的任何内容），他们可以使用它将邮件群发脚本插入文档，或者简单地使用它来重定向到任何其他Web资源，并且让你的服务器看上去就是发送请求的那个服务器。垃圾邮件制造者就有了施展才华的地方了。</p><h3 style="margin-top:1.5em; margin-right:0px; margin-bottom:1em; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:16px; font:inherit; vertical-align:baseline; font-weight:normal; font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">使用白名单和过滤代理<p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">因而，要想使用代理，就得确保有被认可的URI的白名单。此外，除了另一个HTML文档的主体，其他的都除去比较好。另一个好办法是过滤脚本。这会避免显示错误和执行你本不想在网站上执行的脚本。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">就像下面这样：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">&lt;?php$url = $_GET['url'];$allowedurls = array('http://developer.yahoo.com','http://icant.co.uk');if(in_array($url,$allowedurls)){$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$output = curl_exec($ch);curl_close($ch);$content = preg_replace('/.*&lt;body[^&gt;]*&gt;/msi','',$output);$content = preg_replace('/&lt;/body&gt;.*/msi','',$content);$content = preg_replace('/&lt;?/body[^&gt;]*&gt;/msi','',$content);$content = preg_replace('/[r|n]&#43;/msi','',$content);$content = preg_replace('/&lt;--[Ss]*?--&gt;/msi','',$content);$content = preg_replace('/&lt;noscript[^&gt;]*&gt;[Ss]*?&lt;/noscript&gt;/msi','',$content);$content = preg_replace('/&lt;script[^&gt;]*&gt;[Ss]*?&lt;/script&gt;/msi','',$content);$content = preg_replace('/&lt;script.*/&gt;/msi','',$content);echo $content;} else {echo 'Error: URL not allowed to load here.';}?&gt;</code></pre><h3 style="margin-top:1.5em; margin-right:0px; margin-bottom:1em; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:16px; font:inherit; vertical-align:baseline; font-weight:normal; font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">使用YQL的纯JavaScript解决方案<p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">但是，如果没有权利访问服务器，或者你只想使用JavaScript，怎么办？不用担心，这是可以做到的。借助YQL可以加载任何HTML文档，并以JSON&#26684;式返回。jQuery具有加载JSON的好接口，因此与YQL一起使用就可以达到我们的目的。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">从YQL获取HTML很容易，使用下面语句即可：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">select * from html where url=&quot;http://icant.co.uk&quot;</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">YQL还可以完成下面一些事：</p><ul style="margin-top:0px; margin-right:0px; margin-bottom:1em; margin-left:28px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; list-style-position:initial; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px"><li style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline">加载并清理HTML文档<li style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline">使用HTML Tidy运行HTML文档来删除不好的标记<li style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline">缓存HTML<li style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline">只返回HTML的主体内容，因而除内联样式外不需处理其他样式<p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">数据输出&#26684;式可以是XML或JSON。如果为JSON定义了回调参数，就表明要使用JSON-P，所有HTML都会保存在一个JavaScript对象中——这不适合重组。</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">foo({&quot;query&quot;:{&lt;a href=&quot;&quot;1&quot; title=&quot;&quot;&gt;count&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;2010-01-10T07:51:43Z&quot; title=&quot;&quot;&gt;created&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;en-US&quot; title=&quot;&quot;&gt;lang&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;2010-01-10T07:51:43Z&quot; title=&quot;&quot;&gt;updated&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;http://query.yahoo[...whatever...]k%22&quot; title=&quot;&quot;&gt;uri&lt;/a&gt;&quot;,&quot;results&quot;:{&quot;body&quot;:{&quot;div&quot;:{&lt;a href=&quot;&quot;doc2&quot; title=&quot;&quot;&gt;id&lt;/a&gt;&quot;,&lt;a href=&quot;[{&quot;id&quot;:&quot;hd&quot; title=&quot;&quot;&gt;div&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;icant.co.uk&quot; title=&quot;&quot;&gt;h1&lt;/a&gt; - everything Christian Heilmann&quot;},{&lt;a href=&quot;&quot;bd&quot; title=&quot;&quot;&gt;id&lt;/a&gt;&quot;,&quot;div&quot;:[{&lt;a href=&quot;[{&quot;h2&quot;:&quot;About&quot; title=&quot;&quot;&gt;div&lt;/a&gt; this and me&quot;,&quot;[... and so on...]}}}}}}}});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">当定义了带XML输出的回调时，会得到将HTML数据作为数组中字符串的函数调用，简单多了：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">foo({&quot;query&quot;:{&lt;a href=&quot;&quot;1&quot; title=&quot;&quot;&gt;count&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;2010-01-10T07:47:40Z&quot; title=&quot;&quot;&gt;created&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;en-US&quot; title=&quot;&quot;&gt;lang&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;2010-01-10T07:47:40Z&quot; title=&quot;&quot;&gt;updated&lt;/a&gt;&quot;,&lt;a href=&quot;&quot;http://query.y[...who&quot; title=&quot;&quot;&gt;uri&lt;/a&gt; cares...]%22&quot;},&quot;results&quot;:[&quot;&lt;body&gt;n    &lt;div id=&quot;doc2&quot;&gt;n      &lt;div id=&quot;hd&quot;&gt;n&lt;h1&gt;icant.co.uk - everything Christian Heilmann&lt;/h1&gt;n... and so on ...&quot;]});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">使用jQuery的<code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">getJSON()</code>方法，访问YQL端点，这很容易实现：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$.getJSON(&quot;http://query.yahooapis.com/v1/public/yql?&quot;&#43;&quot;q=select%20*%20from%20html%20where%20url%3D%22&quot;&#43;encodeURIComponent(url)&#43;&quot;%22&amp;format=xml'&amp;callback=?&quot;,function(data){if(data.results[0]){var data = filterData(data.results[0]);container.html(data);} else {var errormsg = '&lt;p&gt;Error: could not load the page.&lt;/p&gt;';container.html(errormsg);}});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">组合在一起可以得到使用jQuery和YQL的跨域Ajax解决方案：</p><pre class="prettyprint" style="margin-top:0px; margin-bottom:10px; padding-top:5px; padding-right:5px; padding-bottom:5px; padding-left:5px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif; background-color:rgb(255,255,255); overflow-x:auto; overflow-y:auto; width:650px; max-height:600px; color:rgb(51,51,51); line-height:23px"><code style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; font-family:Consolas,Menlo,Monaco,'Lucida Console','Liberation Mono','DejaVu Sans Mono','Bitstream Vera Sans Mono','Courier New',monospace,serif">$(document).ready(function(){var container = $('#target');$('.ajaxtrigger').click(function(){doAjax($(this).attr('href'));return false;});function doAjax(url){// 如果它是个外部URIif(url.match('^http')){// 调用YQL$.getJSON(&quot;http://query.yahooapis.com/v1/public/yql?&quot;&#43;&quot;q=select%20*%20from%20html%20where%20url%3D%22&quot;&#43;encodeURIComponent(url)&#43;&quot;%22&amp;format=xml'&amp;callback=?&quot;,// 这个函数得到的数据来自成功的JSON-P调用function(data){// 如果有数据，过滤它并呈现出来if(data.results[0]){var data = filterData(data.results[0]);container.html(data);// 否则提示出错了} else {var errormsg = '&lt;p&gt;Error: could not load the page.&lt;/p&gt;';container.html(errormsg);}});// 如果它不是外部URI，使用Ajax的load()方法} else {$('#target').load(url);}}// 过滤掉一些不好的东西function filterData(data){data = data.replace(/&lt;?/body[^&gt;]*&gt;/g,'');data = data.replace(/[r|n]&#43;/g,'');data = data.replace(/&lt;--[Ss]*?--&gt;/g,'');data = data.replace(/&lt;noscript[^&gt;]*&gt;[Ss]*?&lt;/noscript&gt;/g,'');data = data.replace(/&lt;script[^&gt;]*&gt;[Ss]*?&lt;/script&gt;/g,'');data = data.replace(/&lt;script.*/&gt;/,'');return data;}});</code></pre><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px">当然，这个例子还很粗糙。实际的Ajax解决方案应该考虑超时，以及未找到文档的情况。查看带加载指示器、异常处理和黄褪技术的完整代码以获得灵感。</p><p style="margin-top:0px; margin-bottom:1em; padding-top:0px; padding-bottom:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:14px; font:inherit; vertical-align:baseline; clear:both; color:rgb(51,51,51); font-family:MicrosoftYaHei,微软雅黑,Arial,Tahoma,Halvetica,Georgia,sans-serif,STXihei,华文黑体,Hei,'Hiragino Kaku Gothic Pro',SimSun; line-height:23px"></p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>