---
layout: post
title: Memcached是什么?
---

<p>     Memcached是由Danga Interactive开发的，高性能的，分布式的内存对象缓存系统，用于在动态应用中减少数据库负载，提升访问速度。    Memcached能缓存什么？     通过在内存里维护一个统一的巨大的hash表，Memcached能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。    Memcached快么？         非常快。Memcached使用了libevent（如果可以的话，在linux下使用epoll）来均衡任何数量的打开链接，使用非阻塞的网络I/O，对内部对象实现引用计数(因此，针对多样的客户端，对象可以处在多样的状态)， 使用自己的页块分配器和哈希表， 因此虚拟内存不会产生碎片并且虚拟内存分配的时间复杂度可以保证为O(1).。    Danga Interactive为提升Danga Interactive的速度研发了Memcached。目前，LiveJournal.com每天已经在向一百万用户提供多达两千万次的页面访问。而这些，是由一个由web服务器和数据库服务器组成的集群完成的。Memcached几乎完全放弃了任何数据都从数据库读取的方式，同时，它还缩短了用户查看页面的速度、更好的资源分配方式，以及Memcache失效时对数据库的访问速度。    Memcached的特点    Memcached的缓存是一种分布式的，可以让不同主机上的多个用户同时访问， 因此解决了共享内存只能单机应用的局限，更不会出现使用数据库做类似事情的时候，磁盘开销和阻塞的发生。    Memcached的使用     </p>  <p>一 、Memcached服务器端的安装 （此处将其作为系统服务安装）    下载文件：memcached 1.2.1 for Win32 binaries (Dec 23, 2006)    1. 解压缩文件到c:\memcached    2. 命令行输入 'c:\memcached\memcached.exe -d install'    3. 命令行输入 'c:\memcached\memcached.exe -d start' ，该命令启动 Memcached ，默认监听端口为 11211    注:通过 memcached.exe -h 可以查看其帮助</p>  <p>常用设置：     -p &lt;num&gt; 监听的端口    -l &lt;ip_addr&gt; 连接的IP地址, 默认是本机    -d start 启动memcached服务    -d restart 重起memcached服务    -d stop|shutdown 关闭正在运行的memcached服务    -d install 安装memcached服务    -d uninstall 卸载memcached服务    -u &lt;username&gt; 以&lt;username&gt;的身份运行 (仅在以root运行的时候有效)    -m &lt;num&gt; 最大内存使用，单位MB。默认64MB    -M 内存耗尽时返回错误，而不是删除项    -c &lt;num&gt; 最大同时连接数，默认是1024    -f &lt;factor&gt; 块大小增长因子，默认是1.25    -n &lt;bytes&gt; 最小分配空间，key+value+flags默认是48    -h 显示帮助</p>  <p>C# 下可用的API(每个客户端API中都有详细的说明和注释)</p>  <p>Memcached .NET客户端：</p>  <p>1).NET memcached client library</p>  <p> 下载地址：https://sourceforge.net/projects/memcacheddotnet</p>  <p>2）enyim.com Memcached Client</p>  <p> 下载地址：‍https://github.com/enyim/EnyimMemcached/</p>  <p>3）Memcached Providers</p>  <p> 下载地址：http://www.codeplex.com/memcachedproviders</p>  <p>注意：直接点击Download按钮会下载一个pdf文档Demo，里面介绍了Memcached Providers，下载此类库需要切换到Download选项卡页面。</p>  <p>4) BeIT Memcached</p>  <p> 下载地址：http://code.google.com/p/beitmemcached/</p>  <p>二、 .NET memcached client library   下载文件：https://sourceforge.net/projects/memcacheddotnet/</p>  <p>里面有.Net1.1 和 .Net2.0的两种版本 还有一个不错的例子。</p>  <p>‍EnyimMemcached https://github.com/enyim/EnyimMemcached/wiki</p>  <p>[代码] Program.cs   using System;    using System.Collections.Generic;    using System.Text;    using Enyim.Caching;    using Enyim.Caching.Memcached;    using System.Net;    using Enyim.Caching.Configuration;    using Membase;    using Membase.Configuration;    using System.Threading;</p>  <p>namespace DemoApp   {    class Program    {    static void Main(string[] args)    {    log4net.Config.XmlConfigurator.Configure();</p>  <p>// or just initialize the client from code   var nscc = new MembaseClientConfiguration();</p>  <p>nscc.SocketPool.ReceiveTimeout = new TimeSpan(0, 0, 2);   nscc.SocketPool.DeadTimeout = new TimeSpan(0, 0, 10);</p>  <p>nscc.Urls.Add(new Uri(&quot;http://192.168.2.160:8091/pools/default&quot;));    nscc.Urls.Add(new Uri(&quot;http://192.168.2.162:8091/pools/default&quot;));    nscc.Credentials = new NetworkCredential(&quot;A&quot;, &quot;11111111&quot;);    //nscc.BucketPassword = &quot;pass&quot;;</p>  <p>ThreadPool.QueueUserWorkItem(o =&gt; StressTest(new MembaseClient(nscc, &quot;default&quot;), &quot;TesT_A_&quot;));   //ThreadPool.QueueUserWorkItem(o =&gt; StressTest(new MembaseClient(nscc, &quot;default&quot;), &quot;TesT_B_&quot;));    //ThreadPool.QueueUserWorkItem(o =&gt; StressTest(new MembaseClient(nscc, &quot;default&quot;), &quot;TesT_C_&quot;));    //ThreadPool.QueueUserWorkItem(o =&gt; StressTest(new MembaseClient(nscc, &quot;default&quot;), &quot;TesT_D_&quot;));</p>  <p>Console.ReadLine();</p>  <p>return;</p>  <p>var mcc = new MemcachedClientConfiguration();   mcc.AddServer(&quot;192.168.2.200:11211&quot;);    mcc.AddServer(&quot;192.168.2.202:11211&quot;);</p>  <p>mcc.SocketPool.ReceiveTimeout = new TimeSpan(0, 0, 4);   mcc.SocketPool.ConnectionTimeout = new TimeSpan(0, 0, 4);    mcc.SocketPool.DeadTimeout = new TimeSpan(0, 0, 10);</p>  <p>StressTest(new MemcachedClient(mcc), &quot;TesT_&quot;);</p>  <p>return;</p>  <p>var nc = new MembaseClient(nscc, &quot;content&quot;);</p>  <p>var stats1 = nc.Stats(&quot;slabs&quot;);   foreach (var kvp in stats1.GetRaw(&quot;curr_connections&quot;))    Console.WriteLine(&quot;{0} -&gt; {1}&quot;, kvp.Key, kvp.Value);</p>  <p>var nc2 = new MembaseClient(nscc, &quot;content&quot;);</p>  <p>var stats2 = nc2.Stats();   foreach (var kvp in stats2.GetRaw(&quot;curr_connections&quot;))    Console.WriteLine(&quot;{0} -&gt; {1}&quot;, kvp.Key, kvp.Value);    }</p>  <p>private static void StressTest(MemcachedClient client, string keyPrefix)   {    var i = 0;    var last = true;</p>  <p>var progress = @&quot;-\|/&quot;.ToCharArray();   Console.CursorVisible = false;    Dictionary&lt;bool, int&gt; counters = new Dictionary&lt;bool, int&gt;() { { true, 0 }, { false, 0 } };</p>  <p>while (true)   {    var key = keyPrefix + i;    var state = client.Store(StoreMode.Set, key, i) &amp; client.Get&lt;int&gt;(key) == i;</p>  <p>Action updateTitle = () =&gt; Console.Title = &quot;Success: &quot; + counters[true] + &quot; Fail: &quot; + counters[false];</p>  <p>if (state != last)   {    Console.ForegroundColor = state ? ConsoleColor.White : ConsoleColor.Red;    Console.Write(&quot;.&quot;);</p>  <p>counters[state] = 0;   last = state;</p>  <p>updateTitle();   }    else if (i % 200 == 0)    {    //Console.ForegroundColor = state ? ConsoleColor.White : ConsoleColor.Red;</p>  <p>//Console.Write(progress[(i / 200) % 4]);   //if (Console.CursorLeft == 0)    //{    // Console.CursorLeft = Console.WindowWidth - 1;    // Console.CursorTop -= 1;    //}    //else    //{    // Console.CursorLeft -= 1;    //}</p>  <p>updateTitle();   }</p>  <p>i++;   counters[state] = counters[state] + 1;    }    }    }    }    [代码] App.config    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;    &lt;configuration&gt;    &lt;configSections&gt;    &lt;section name=&quot;log4net&quot; type=&quot;log4net.Config.Log4NetConfigurationSectionHandler,log4net&quot; /&gt;    &lt;sectionGroup name=&quot;enyim.com&quot;&gt;    &lt;section name=&quot;memcached&quot; type=&quot;Enyim.Caching.Configuration.MemcachedClientSection, Enyim.Caching&quot; /&gt;    &lt;section name=&quot;log&quot; type=&quot;Enyim.Caching.Configuration.LoggerSection, Enyim.Caching&quot; /&gt;    &lt;/sectionGroup&gt;    &lt;section name=&quot;memcached&quot; type=&quot;Enyim.Caching.Configuration.MemcachedClientSection, Enyim.Caching&quot; /&gt;    &lt;section name=&quot;northscale&quot; type=&quot;Membase.Configuration.MembaseClientSection, Membase&quot; /&gt;    &lt;section name=&quot;membase&quot; type=&quot;Membase.Configuration.MembaseClientSection, Membase&quot; /&gt;    &lt;/configSections&gt;</p>  <p>&lt;northscale&gt;   &lt;servers bucket=&quot;default&quot;&gt;    &lt;add uri=&quot;http://192.168.2.200:8080/pools/default&quot; /&gt;    &lt;/servers&gt;    &lt;socketPool minPoolSize=&quot;10&quot; maxPoolSize=&quot;100&quot; connectionTimeout=&quot;00:00:10&quot; /&gt;    &lt;locator type=&quot;Enyim.Caching.Memcached.DefaultNodeLocator, Enyim.Caching&quot; /&gt;    &lt;/northscale&gt;</p>  <p>&lt;membase&gt;   &lt;servers bucket=&quot;mc_pass&quot; userName=&quot;A&quot; password=&quot;11111111&quot; bucketPassword=&quot;pass&quot;&gt;    &lt;add uri=&quot;http://192.168.2.160:8080/pools/default&quot; /&gt;    &lt;/servers&gt;    &lt;socketPool connectionTimeout=&quot;00:00:02&quot; deadTimeout=&quot;00:00:10&quot; /&gt;    &lt;/membase&gt;</p>  <p>&lt;enyim.com&gt;   &lt;log factory=&quot;Enyim.Caching.Log4NetFactory, Enyim.Caching.Log4NetAdapter&quot; /&gt;    &lt;memcached&gt;    &lt;servers&gt;    &lt;add address=&quot;192.168.2.200&quot; port=&quot;11211&quot; /&gt;    &lt;add address=&quot;192.168.2.202&quot; port=&quot;11211&quot; /&gt;    &lt;add address=&quot;192.168.2.204&quot; port=&quot;11211&quot; /&gt;    &lt;/servers&gt;    &lt;socketPool minPoolSize=&quot;10&quot; maxPoolSize=&quot;100&quot; connectionTimeout=&quot;00:00:10&quot; deadTimeout=&quot;00:02:00&quot; /&gt;    &lt;!--&lt;authentication type=&quot;Enyim.Caching.Memcached.PlainTextAuthenticator, Enyim.Caching&quot; userName=&quot;demo&quot; password=&quot;demo&quot; /&gt;--&gt;    &lt;/memcached&gt;    &lt;/enyim.com&gt;</p>  <p>&lt;log4net&gt;   &lt;appender name=&quot;ConsoleAppender&quot; type=&quot;log4net.Appender.ConsoleAppender&quot;&gt;    &lt;layout type=&quot;log4net.Layout.PatternLayout,log4net&quot;&gt;    &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d [%t] %-5p %c %m%n&quot; /&gt;    &lt;/layout&gt;    &lt;/appender&gt;    &lt;appender name=&quot;TraceAppender&quot; type=&quot;log4net.Appender.TraceAppender&quot;&gt;    &lt;layout type=&quot;log4net.Layout.PatternLayout,log4net&quot;&gt;    &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d [%t] %-5p %c %m%n&quot; /&gt;    &lt;/layout&gt;    &lt;/appender&gt;    &lt;root&gt;    &lt;level value=&quot;Info&quot; /&gt;    &lt;appender-ref ref=&quot;TraceAppender&quot; /&gt;    &lt;/root&gt;    &lt;logger name=&quot;Enyim.Caching.Memcached.DefaultNodeLocator&quot;&gt;    &lt;level value=&quot;Debug&quot; /&gt;    &lt;/logger&gt;     &lt;logger name=&quot;Enyim.Caching.Memcached.PooledSocket&quot;&gt;    &lt;level value=&quot;Info&quot; /&gt;    &lt;/logger&gt;    &lt;logger name=&quot;Enyim.Caching.Memcached.Protocol&quot;&gt;    &lt;level value=&quot;Info&quot; /&gt;    &lt;/logger&gt;    &lt;logger name=&quot;Membase.VBucketAwareOperationFactory&quot;&gt;    &lt;level value=&quot;Info&quot; /&gt;    &lt;/logger&gt;    &lt;logger name=&quot;Enyim.Caching.Memcached.MemcachedNode&quot;&gt;    &lt;level value=&quot;Info&quot; /&gt;    &lt;/logger&gt;    &lt;/log4net&gt;</p>  <p>&lt;/configuration&gt;</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>