---
layout: post
title: .NET 客户端连接Redis 介绍
---

<p>.NET 客户端连接Redis 介绍2011-07-17 22:10C#写的客户端类型主要有：</p><p>ServiceStack.Redis &#9733; https://github.com/ServiceStack/ServiceStack.RedisBooksleeve &#9733; http://code.google.com/p/booksleeve/Sider http://nuget.org/List/Packages/SiderTeamDev Redis Client http://redis.codeplex.com/redis-sharp https://github.com/migueldeicaza/redis-sharp</p><p>加星号的是使用率高的项目。参考：http://redis.io/clients</p><p>以ServiceStack.Redis为例</p><p>引入到项目中，并添加如下名空间引用(仅限本文):</p><p>using ServiceStack.Common.Extensions;using ServiceStack.Redis;using ServiceStack.Redis.Generic;using ServiceStack.Text;using ServiceStack.Redis.Support;</p><p>注：ServiceStackRedis封装了大量方法和对象，这里只摘有代表性的内容介绍，更多内容参见其官方文档。</p><p>声明一个客户端对象：protected RedisClient Redis = new RedisClient("127.0.0.1", 6379);//redis服务IP和端口</p><p>一 .基本KEY/VALUE键值对操作：1. 添加/获取:</p><p>List&lt;string&gt; storeMembers =new List&lt;string&gt;();storeMembers.ForEach(x =&gt; Redis.AddItemToList("additemtolist", x));注：也可直接使用AddRangeToList方法将一组数据装入如：</p><p>Redis.AddRangeToList("addarrangetolist", storeMembers);</p><p>2. 获取数据</p><p>var members = Redis.GetAllItemsFromList("additemtolist");members.ForEach(s =&gt; Response.Write("&lt;br/&gt;additemtolist :"+ s));</p><p>3. 获取指定索引位置数据</p><p>var item = Redis.GetItemFromList("addarrangetolist", 2);</p><p>4. 移除：</p><p>var list = Redis.Lists["addarrangetolist"];list.Clear();//清空list.Remove("two");//移除指定键值list.RemoveAt(2);//移除指定索引位置数据</p><p>二.存储对象：</p><p>publicclass UserInfo{publiclong Id { set; get; }publicstring UserName { get; set; }publicint Age { get; set; }}</p><p>1.通常方式（底层使用json序列化）：</p><p>Redis.Set&lt;UserInfo&gt;("userinfo", new UserInfo() { UserName ="李四", Age =45 });UserInfo userinfo = Redis.Get&lt;UserInfo&gt;("userinfo");</p><p>注：当然上面方式也适合于基本类型，如：</p><p>Redis.Set&lt;int&gt;("my_age", 12);//或Redis.Set("my_age", 12);int age = Redis.Get&lt;int&gt;("my_age");</p><p>2.object序列化方式存储：</p><p>var ser =new ObjectSerializer(); //位于namespace ServiceStack.Redis.Support;bool result = Redis.Set&lt;byte[]&gt;("userinfo", ser.Serialize(new UserInfo() { UserName ="张三", Age =12 }));UserInfo userinfo = ser.Deserialize(Redis.Get&lt;byte[]&gt;("userinfo")) as UserInfo;//也支持列表Redis.Set&lt;byte[]&gt;("userinfolist_serialize", ser.Serialize(userinfoList));List&lt;UserInfo&gt; userList = ser.Deserialize(Redis.Get&lt;byte[]&gt;("userinfolist_serialize")) as List&lt;UserInfo&gt;;</p><p>需要说明的是在测试过程中发现JSON序列化的效率要比object序列化高一些。</p><p>三.存储表格对象，比如：</p><p>using (var redisUsers = Redis.GetTypedClient&lt;UserInfo&gt;()){redisUsers.Store(new UserInfo { Id = redisUsers.GetNextSequence(), UserName ="daizhj", Age =12 });redisUsers.Store(new UserInfo { Id = redisUsers.GetNextSequence(), UserName ="daizhenjun", Age =13 });</p><p>var allUsers = redisUsers.GetAll();//就像操作ado对象一样，可以进行CRUD等操作allUsers.ForEach(s =&gt; Response.Write("&lt;br/&gt;user :"+ s.UserName +" age:"+ s.Age));}</p><p>四.使用客户端链接池模式提升链接速度：</p><p>publicstatic PooledRedisClientManager CreateManager(string[] readWriteHosts, string[] readOnlyHosts){//支持读写分离，均衡负载returnnew PooledRedisClientManager(readWriteHosts, readOnlyHosts, new RedisClientManagerConfig{MaxWritePoolSize =5,//&#8220;写&#8221;链接池链接数MaxReadPoolSize =5,//&#8220;写&#8221;链接池链接数AutoStart =true,}); }</p><p>声明链接池对象（这里只使用一个redis服务端）：</p><p>PooledRedisClientManager prcm = CreateManager(newstring[] { "127.0.0.1:6379" }, newstring[] { "127.0.0.1:6379" });</p><p>List&lt;UserInfo&gt; userinfoList =new List&lt;UserInfo&gt;();userinfoList.Add(new UserInfo() { UserName ="pool_daizhj", Age =1 });userinfoList.Add(new UserInfo() { UserName ="pool_daizhj1", Age =2 });</p><p>从池中获取一个链接：</p><p>using (IRedisClient Redis = prcm.GetClient()){ Redis.Set("userinfolist", userinfoList);List&lt;UserInfo&gt; userList = Redis.Get&lt;List&lt;UserInfo&gt;&gt;("userinfolist");}</p><p>注：1.前三种方式我在本地测试发现存取效率从高到底，具体原因还待分析。</p><p>2.如只想使用长链接而不是链接池的话，可以直接将下面对象用static方式声明即可： protected static RedisClient Redis = new RedisClient("127.0.0.1", 6379);</p><p>这样在redis服务端显示只有一个客户链接</p><p>3.与memcached测试过程中发现，在存储时两者效率接近（使用本文第一种方式），在取数据时memcached速度比redis要快一些（毫秒级差异），这一点并不像网上一些文章所说的那样，看来在实际开发和生产环境下还要以使用背景及结果为准。</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>