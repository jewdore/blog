---
layout: post
title: Titanium suds.js的理解
---

<p> 代码部分：</p>/***Suds:ALightweightJavaScriptSOAPClient一个轻量级的SOAP客户端*Copyright:2009KevinWhinnery(http://www.kevinwhinnery.com)版权:xxx*License:http://www.apache.org/licenses/LICENSE-2.0.html*Source:http://github.com/kwhinnery/Suds源码地址*/functionSudsClient(_options){//Agenericextendfunction-thanksMooTools//定义默认变量，修改变量functionextend(original,extended){//传入原件和扩展数据extended=extended||{};//是否拥有对象，木有则创建对象for(varkeyinextended){//遍历对象if(extended.hasOwnProperty(key)){//是否拥有此方法original[key]=extended[key];//将extended自身的方法添加到原件中}}returnoriginal;//返回原件}//Checkifanobjectisanarray//查看一个对象是否为数组functionisArray(obj){returnObject.prototype.toString.call(obj)=='[objectArray]';//获取对象类型}//GrabanXMLHTTPRequestObject//创建一个XMLHTTPRequest对象functiongetXHR(){varxhr;if(window.XMLHttpRequest){xhr=newXMLHttpRequest();}else{xhr=newActiveXObject("Microsoft.XMLHTTP");}returnxhr;//有对象了}//ParseastringandcreateanXMLDOMobject//通过解析string创建一个XMLDOM对象functionxmlDomFromString(_xml){//传进来一个xml格式的stringvarxmlDoc=null;if(window.DOMParser){//判断浏览器支持parser=newDOMParser();xmlDoc=parser.parseFromString(_xml,"text/xml");//格式成xmlDoc}else{xmlDoc=newActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";//关闭异步xmlDoc.loadXML(_xml);//加载}returnxmlDoc;//返回}//ConvertaJavaScriptobjecttoanXMLstring-takeseitheran//将对象(最好是JSON)为XMLstringfunctionconvertToXml(_obj){varxml='';if(isArray(_obj)){//先看一下对象是否为数组for(vari=0;i&lt;_obj.length;i++){xml+=convertToXml(_obj[i]);}}else{//Fornowassumingweeitherhaveanarrayoranobjectgraph//假设我们拥有数组或对象任意一个for(varkeyin_obj){xml+='&lt;'+key+'&gt;';if(isArray(_obj[key])||(typeof_obj[key]=='object'&amp;&amp;_obj[key]!=null)){xml+=convertToXml(_obj[key]);}else{xml+=_obj[key];}xml+='&lt;/'+key+'&gt;';}}returnxml;//方法就是遍历整个_obj，再单独遍历单个，将key作为节点，值为值}//ClientConfiguration//客户端配置varconfig=extend({endpoint:'http://localhost',//这些都是默认配置，在不修改的情况下使用targetNamespace:'http://localhost',//目标命名空间envelopeBegin:'&lt;?xmlversion="1.0"encoding="utf-8"?&gt;&lt;soap:Envelopexmlns:ns0="PLACEHOLDER"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xmlns:xsd="http://www.w3.org/2001/XMLSchema"xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;',headerBegin:'&lt;soap:Header&gt;',headerNode:'head',headerEnd:'&lt;/soap:Header&gt;',bodyBegin:'&lt;soap:Body&gt;',envelopeEnd:'&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;',timeout:5000},_options);//_options参数传入需要修改的部分//Invokeawebservicethis.invoke=function(_soapAction,_body,_callback,_error,_header){//对象调用方法//不需要的直接不传//Buildrequestbodyvarbody=_body;//body应该是一个对象样式，转成xml格式varheader=_header;//设置header//AllowstraightstringinputforXMLbody-ifnot,buildfromobjectif(typeofbody!=='string'){//传入的参数判断body='&lt;'+_soapAction+'xmlns="'+config.targetNamespace+'"&gt;';body+=convertToXml(_body);//配置格式body+='&lt;/'+_soapAction+'&gt;';}//最终得到xmlvarebegin=config.envelopeBegin;config.envelopeBegin=ebegin.replace('PLACEHOLDER',config.targetNamespace);//BuildSoapactionheader-ifnotrailingslashinnamespace,needtospliceoneinforsoapactionvarsoapAction='';//这段是将_soapAction添加到url中，判定是否有'/'在最后if(config.targetNamespace.lastIndexOf('/')!=config.targetNamespace.length-1){soapAction=config.targetNamespace+'/'+_soapAction;}else{soapAction=config.targetNamespace+_soapAction;}//POSTxml到服务终结点varxhr=getXHR();//创建对象xhr.onload=function(){//回调函数执行_callback.call(this,xmlDomFromString(this.responseText));//将值转成XMLDOM格式};xhr.onerror=function(){_error.call();//回调错误代码}xhr.setTimeout(config.timeout);//延迟执行时间varsendXML='';if(!header){//参数_header暂时木有用到，设置另外的xmldocsendXML=config.envelopeBegin+body+config.envelopeEnd;//发送到值}else{//AllowstraightstringinputforXMLbody-ifnot,buildfromobjectif(typeofheader!=='string'){//设置需要的sendXMLheader='&lt;'+_soapAction+'xmlns="'+config.targetNamespace+'"&gt;';header+=convertToXml(_header);header+='&lt;/'+_soapAction+'&gt;';}sendXML=config.envelopeBegin+config.headerBegin+header+config.headerEnd+config.bodyBegin+body+config.envelopeEnd;}xhr.open('POST',config.endpoint);//open方法xhr.setRequestHeader('Content-Type','text/xml');//请求头类型xhr.setRequestHeader('Content-Length',sendXML.length);//设置长度，节省资源？xhr.setRequestHeader('SOAPAction',soapAction);//设置SOAPActionif(config.authorization!==undefined){//授权xhr.setRequestHeader('Authorization','Basic'+config.authorization);}xhr.send(sendXML);//发送出去};}

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>