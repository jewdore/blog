---
layout: post
title: Libevent最新稳定版2.0.16在vs2010下编译并编写webserver测试用例
---

<p>下载</p><p>libevent2.0.16稳定版</p><p>https://github.com/downloads/libevent/libevent/libevent-2.0.16-stable.tar.gz</p><p>进入VS2010命令提示</p><p>d:</p><p>cd libevent-2.0.16-stable</p><p>nmake /f Makefile.nmake</p><p>编译成功生成</p><p>libevent.lib libevent_core.lib libevent_extras.lib</p><p>用vs2010 创建一个win32控制台应用程序，项目名称Httpd，取消为解决方案创建目录选项,位置d:\test</p><p>然后两个下一步，应用程序类型选择控制台应用程序，附加选项勾选空项目，其他选项空，完成。</p><p>新建Httpd.c,输入下面代码#include &lt;stdio.h&gt;</p><p>#define WIN32_LEAN_AND_MEAN#include &lt;windows.h&gt;#include &lt;winsock2.h&gt;</p><p>#include &lt;event.h&gt;#include &lt;evhttp.h&gt;</p><p>void root_handler(struct evhttp_request *req, void *arg){ struct evbuffer *buf = evbuffer_new(); if(!buf){ puts("failed to create response buffer"); return; }</p><p> evbuffer_add_printf(buf, "Hello: %s\n", evhttp_request_uri(req)); evhttp_send_reply(req, HTTP_OK, "OK", buf);}</p><p>void generic_handler(struct evhttp_request *req, void *arg){ struct evbuffer *buf = evbuffer_new(); if(!buf){ puts("failed to create response buffer"); return; }</p><p> evbuffer_add_printf(buf, "Requested: %s\n", evhttp_request_uri(req)); evhttp_send_reply(req, HTTP_OK, "OK", buf);}</p><p>int main(int argc, wchar_t* argv[]){struct evhttp *httpd;</p><p>WSADATA wsaData;DWORD Ret;if ((Ret = WSAStartup(MAKEWORD(2, 2), &amp;wsaData)) != 0){printf("WSAStartup failed with error %d\n", Ret);return -1;}</p><p> event_init();</p><p> httpd = evhttp_start("0.0.0.0", 18505); if(!httpd){return 1;}</p><p> evhttp_set_cb(httpd, "/", root_handler, NULL); evhttp_set_gencb(httpd, generic_handler, NULL);</p><p>printf("httpd server start OK!\n");</p><p> event_dispatch();</p><p> evhttp_free(httpd);</p><p>WSACleanup(); return 0;}</p><p>复制include 和libs</p><p>mkdir D:\test\httpd\include\xcopy /E /H /R D:\libevent-2.0.16-stable\include\* D:\test\httpd\include\xcopy /E /H /R D:\libevent-2.0.16-stable\WIN32-Code\* D:\test\httpd\include\xcopy /E /H /R D:\libevent-2.0.16-stable\*.h D:\test\httpd\include\mkdir d:\test\httpd\libscopy D:\libevent-2.0.16-stable\*.lib D:\test\httpd\libs\</p><p>进入配置管理器，设置活动项目为release。</p><p>设置release 的项目选项</p><p>C++常规\附加包含目录 .\include;.\include\event2代码生成\运行库 多线程 (/MT)高级\编译为 编译为 C 代码 (/TC)链接器常规\附加库目录 .\libs输入\附加依赖项 ws2_32.lib;wsock32.lib;libevent.lib;libevent_core.lib;libevent_extras.lib;%(AdditionalDependencies)输入\忽略特定默认库 libc.lib;msvcrt.lib;libcd.lib;libcmtd.lib;msvcrtd.lib;%(IgnoreSpecificDefaultLibraries)</p><p>注意%(AdditionalDependencies)不能漏掉，否则会报编译错误错误1error LNK2001: 无法解析的外部符号 __imp__CryptGenRandom@12D:\test\httpd\libevent.lib(evutil_rand.obj)httpdhttpd.c</p><p>F6编译成功</p><p>CTRL+F5执行程序</p><p>显示服务</p><p>httpd server start OK!</p><p>在浏览器输入</p><p>http://127.0.0.1:18505/</p>显示<p>Hello: / </p><p>整个Libevent2.0.16就这样成功使用了。</p><p>httpd源代码</p><p>关于vs2005使用libevent2.0.10构建的例子，可以参考</p><p>http://blog.s135.com/libevent_windows/2/1/  </p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>