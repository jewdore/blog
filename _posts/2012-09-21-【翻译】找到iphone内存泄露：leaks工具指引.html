---
layout: post
title: 【翻译】找到iPhone内存泄露：Leaks工具指引
---

<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">原文地址：http://www.mobileorchard.com/find-iphone-memory-leaks-a-leaks-tool-tutorial/see also：http://www.iposei.com/?p=127</p><p>我的游戏开发接近了尾声，最近常使用Instruments这个工具。我发现它对追踪游戏中的内存泄露非常有帮助。自从发现Instruments如此有用后，我就觉得写一篇文章介绍如何使用它来追踪内存泄露对其他人也会有帮助。</p><h2 style="margin-top: 12px; margin-right: 0px; margin-bottom: 16px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">什么是内存泄露？我为什么要关心内存泄露？<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">&#8230;此段省略&#8230;访问维基百科可以获得更多关于内存泄露的信息。</p><h2 style="margin-top: 12px; margin-right: 0px; margin-bottom: 16px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">我如何知道内存泄露了？<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">一些内存泄露可以很容易地通过阅读代码来发现，另一些就要困难点了，这就是为什么需要Instruments的原因。Instruments有一个&#8220;Leaks&#8221;工具，它会准确地告诉你什么地方发生了内存泄露，以便你能定位和修复泄露问题。</p><h2 style="margin-top: 12px; margin-right: 0px; margin-bottom: 16px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">例子程序<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">我写了一个例子程序，它有两个地方会发生内存泄露，一个在Objective-C 视图控制器中，另一个在C++类中。例程可以从这里获得。下边的代码是从例程里摘录的，包含了我们需要追踪内存泄露的代码。</p><blockquote style="margin-top: 20px; margin-right: 10px; margin-bottom: 10px; margin-left: 5px; padding-top: 0px; padding-right: 5px; padding-bottom: 0px; padding-left: 5px; border-left-width: 4px; border-left-style: solid; border-left-color: #dddddd; font-size: 9px; text-align: justify; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">// Leaky excerpts &#8211; see GitHub for complete source</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">- (void)viewDidLoad {[super viewDidLoad];</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">LeakyClass* myLeakyInstance = new LeakyClass();delete myLeakyInstance;</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">mMyLeakyString = [[NSString alloc] initWithUTF8String:&#8221;I&#8217;m a leaky string.&#8221;];</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">[self doSomethingNow];}</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">- (void) doSomethingNow{mMyLeakyString = [[NSString alloc] initWithUTF8String:&#8220;Look, another alloc, but no release for first one!&#8221;];}</p></blockquote><blockquote style="margin-top: 20px; margin-right: 10px; margin-bottom: 10px; margin-left: 5px; padding-top: 0px; padding-right: 5px; padding-bottom: 0px; padding-left: 5px; border-left-width: 4px; border-left-style: solid; border-left-color: #dddddd; font-size: 9px; text-align: justify; "><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">// Leaky excerpts &#8211; see GitHub for complete source</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">LeakyClass::LeakyClass(){mLeakedObject = new LeakedObject();}</p><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">LeakyClass::~LeakyClass(){}</p></blockquote><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">我会先在Debug模式编译InstrumentsTest，并在iPhone上运行。完成这步，我会启动Instruments。</p><h2 style="margin-top: 12px; margin-right: 0px; margin-bottom: 16px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">Instruments<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 20px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">当你启动Instruments，你可以从一堆Instruments工具里选择你需要的。在左手边选择iPhone，在右手边的图标里双击&#8220;Leaks&#8221;工具：</p><p class="wp-caption-text" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 4px; padding-bottom: 5px; padding-left: 4px; font-size: 11px; line-height: 17px; color: #111111; ">instruments_01</p>

了解破碎机常识：<a href='http://www.crushermillsupplier.com'>crusher mill supplier</a>